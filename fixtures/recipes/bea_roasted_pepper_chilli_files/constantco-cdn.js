/*!
 * @license prod-eu v0.1.29-rc.3
 * Copyright (c) 2012-2016, Constant Commerce Ltd - http://constant.co
 */
function Module(e,t){function i(e){var t={};for(var i in e){var n=e[i].getDefinitions();for(var o in n)t[o]=n[o]}return t}var n=i(t);this.define=function(e,t,i){return n[e]=new Definition(t,i,n),this},this.run=function(e){var t=n[e];return t.callObject()},this.getDefinitions=function(){return n},this.rerun=function(e){var t=n[e];return t.resetCalledObject(),t.callObject()}}function Definition(e,t,i){this.calledObject=null,this.callObject=function(){if(this.calledObject)return this.calledObject;for(var n=[],o=0;o<e.length;o++){var r=i[e[o]];void 0===r?console.log(e[o]+" not defined"):n.push(r.callObject())}return this.calledObject=t.apply(this,n),this.calledObject},this.resetCalledObject=function(){this.calledObject=null},this.replaceObject=function(e){this.calledObject=e}}var $cc={},modules={};$cc.module=function(e,t){if(void 0===t&&e in modules)return modules[e];var i={};if(void 0!==t)for(var n=0;n<t.length;n++)i[t[n]]=modules[t[n]];return modules[e]=new Module(e,i),modules[e]},$cc.module("public").define("publicApi",[],function(){function e(e,t){window.ConstantCo[e]=t}return window.ConstantCo={},{set:e}}),$cc.module("uuid").define("uuid",[],function(){function e(){var e=t(),a=[];return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=15&n(0,255)|64,a[7]=e[6],a[8]=63&n(0,255)|128,a[9]=window.performance&&window.performance.now?Math.floor(1e3*window.performance.now()):n(0,255),a[10]=++o,a[11]=Math.round(window.innerHeight||n(0,255)),a[12]=Math.round(window.innerWidth||n(0,255)),a[13]=(new Date).getTime()-r,a[14]=n(0,255),a[15]=n(0,255),i(a[0])+i(a[1])+i(a[2])+i(a[3])+"-"+i(a[4])+i(a[5])+"-"+i(a[6])+i(a[7])+"-"+i(a[8])+i(a[9])+"-"+i(a[10])+i(a[11])+i(a[12])+i(a[13])+i(a[14])+i(a[15])}function t(){for(var e=[],t=(new Date).getTime().toString(),i=0;i<7;i++)e.push(+t.substr(2*i,2)||0);return e}function i(e){return(e+256).toString(16).substr(-2)}function n(e,t){return Math.floor(Math.random()*(t-e))+e}var o=0,r=(new Date).getTime();return{v4:e}}),$cc.module("comm").define("commService",[],function(){function e(e,t,i){r[e]=r[e]||[],r[e].push({source:i||null,callback:t})}function t(e){e in r&&delete r[e]}function i(e,t,i,n){var i={action:t,data:i};if(n){var r=o();a[r]=n,i.callbackId=r}e.postMessage(JSON.stringify(i),"*")}function n(e){if("string"==typeof e.data){try{var t=JSON.parse(e.data)}catch(i){return}var n=t.action,o=t.callbackId,d=t.callback;if(d&&d in a)a[d](t.response),delete a[d];else if(n&&n in r)for(var s=0;s<r[n].length;s++){var c=r[n][s].source,d=r[n][s].callback;null!==c&&c!==e.source||d(t.data,function(t){var i={callback:o,response:t};e.source.postMessage(JSON.stringify(i),e.origin)})}}}function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+(new Date).getTime()}var r={},a={};return"addEventListener"in window?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),{registerListener:e,unregisterListener:t,sendMessage:i}}),$cc.module("jsonp").define("jsonp",[],function(){function e(e,o,r,a){var d="cccb"+n(),s=!1,c=null;r&&(a=void 0===a?5e3:a,c=window.setTimeout(function(){i(d),r()},a)),window[d]=function(e){s||(window.clearTimeout(c),i(d),o(e))},t(e,d)}function t(e,t){var i=document.createElement("script");i.src=e+(/\?/.test(e)?"&":"?")+"callback=window."+t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n),o[t]=i}function i(e){o[e]&&(o[e].parentNode.removeChild(o[e]),delete o[e])}function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)+(new Date).getTime()}var o={};return{request:e}}),$cc.module("debug",["comm"]).define("debugConfig",[],function(){return{stylesheetUrl:"../src/debug/debug.css"}}),$cc.module("debug").define("debug",["debugConfig"],function(e){function t(){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e.stylesheetUrl,document.getElementsByTagName("head")[0].appendChild(t)}function i(){I=document.createElement("div"),I.setAttribute("id","cc-debug-console"),I.setAttribute("class","cleanslate"),I.expanded=!0,I.setAttribute("style","position: fixed; bottom: 0; left: 0; width: 100%; height: 40%; color: #ddd;background-color: rgba(0,0,0,0.75); font-family: monospace; transition: height 0.1s; z-index: 2147483647;"),document.body.style.paddingBottom="40%",document.body.appendChild(I),T=document.createElement("div"),T.setAttribute("style","width: 100%; height: 50px; border-bottom: 1px solid #666;"),I.appendChild(T),T.addEventListener("click",function(){I.expanded?d():a()})}function n(e){w()&&(C[e].tab.num++,C[e].tab.innerHTML=e+" ("+C[e].tab.num+")")}function o(e){for(var t in C)t===e?(C[t].window.style.display="block",C[t].tab.style.backgroundColor="#555"):(C[t].window.style.display="none",C[t].tab.style.backgroundColor="transparent")}function r(){var e=document.createElement("pre");return e.innerHTML="\n ",e}function a(){document.body.style.paddingBottom=I.style.height="40%",I.expanded=!0}function d(){document.body.style.paddingBottom=I.style.height="50px",I.expanded=!1}function s(e,t){var i=document.createElement("a");return i.num=0,i.innerHTML=e,i.setAttribute("style","text-transform: capitalize; padding: 0 20px; line-height: 50px; float: "+t+"; cursor: pointer; border-"+("left"==t?"right":"left")+": 1px solid #666; text-align: center;"),i.addEventListener("click",function(t){t.stopPropagation(),I.expanded||a(),o(e)}),i}function c(e,t,i){!S||e in C||(i=i||"left",C[e]={tab:s(e,i),logger:!t,window:t||r()},C[e].window.setAttribute("style","position: relative; float: left; background: transparent; width: 100%; height: calc(100% - 50px); color: #ddd; overflow-y: auto; margin: 0;"),T.appendChild(C[e].tab),I.appendChild(C[e].window))}function l(e,t){x(),t=t||"log",S&&C[t].logger&&(n(t),e=e.replace("\n","\n                     "),C[t].window.innerHTML+=u()+" -> "+e+"\n ",C[t].window.scrollTop=C[t].window.scrollHeight)}function u(){var e=new Date,t={month:"short",day:"numeric",hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"};return e.toLocaleString("en-GB",t)}function p(){M=document.createElement("div"),M.style.width="400px",M.style["float"]="left",D.appendChild(M)}function f(e,t,i){var n=h(),o=n&&void 0!==n[e]?n[e]:i;A[e]=i,E[e]=o;var r=document.createElement("fieldSet");r.style.border="none",r.style.paddingLeft="0",r.style.marginLeft="0";var a=document.createElement("label");a.innerHTML=t+":";var d=document.createElement("input");d.id="cc-debug-setting-"+k(e),a.style.marginRight="10px","boolean"==typeof o?(d.type="checkbox",d.checked=o,d.style.position="relative"):(d.type="text",d.value=o,d.style.width="40px"),r.appendChild(a),r.appendChild(d),M.insertBefore(r,L),d.addEventListener("change",function(){var t="checkbox"===d.type?d.checked:d.value;E[e]=t,y()})}function g(e,t){if(w()){var i=m(e,t);M.appendChild(i)}}function m(e,t){var i=document.createElement("p");return i.innerHTML=e,i.style.fontStyle="italic",i.style.textDecoration="underline",i.style.cursor="pointer",i.style.display="block",i.id="cc-debug-action-"+k(e),i.onclick=t,i}function h(){sessionStorage.getItem("cc-debug");return JSON.parse(sessionStorage.getItem("cc-debug"))}function y(){sessionStorage.setItem("cc-debug",JSON.stringify(E))}function v(){sessionStorage.setItem("cc-debug",JSON.stringify(A))}function b(e){return S?E[e]:null}function w(){return S}function k(e){return e.replace(/ /g,"-").replace(/([A-Z])/g,function(e,t){return"-"+t}).toLowerCase()}function x(){w()&&document.body.appendChild(I)}var S=!!window.location.search.match(/[?&](ccDebugMode=on)(?=[&#]|$)/)||!!document.getElementById("ccDebugMode"),C={},I=null,T=null;S&&(t(),i()),c("log"),o("log");var A={},E={},D=document.createElement("div");c("settings",D,"right"),D.style.paddingLeft="10px";var M=null;p(),M.innerHTML='<p style="font-style: italic;"><span style="cursor: pointer; text-decoration: underline;" onclick="window.location.href=window.location.href" id="cc-debug-refresh-page">Refresh</span> for changes to apply</p>';var L=m("Reset all",function(){v(),window.location.href=window.location.href});return L.id="cc-debug-settings-reset",M.appendChild(L),f("sessionMaxAgeSeconds","Session time (seconds)",1800),f("anonymous","Force anonymous mode",!1),f("thirdPartyOnly","Force third party only",!1),{log:l,createView:c,getSetting:b,addSetting:f,incrementNum:n,newSettingsSection:p,addAction:g,isInDebugMode:w,dashSeparate:k,getFormattedTime:u,bringToFront:x}}),$cc.module("debug").define("debugApi",["commService","debug"],function(e,t){function i(e,i){t.log(e.message),i()}e.registerListener("cc-debug-log",i)}),$cc.module("state",["comm","uuid","jsonp","debug"]),$cc.module("state").define("stateConfig",[],function(){return{version:1,thirdPartyUrl:"https://static.foodity.com/state/0.1.6-rc.5/ext.html",thirdPartyIframeId:"cc_tp_frame",localStorageKey:"$cc",shopperIdCookieName:"cc_hash",firstPartyRetailerCookieName:"cc_r",conSessionCheckUrl:"/api/auth",conSessionCheckTimeoutMilliseconds:3e3,lastRetailerCheckUrl:"//api.foodity.com/api/tasks/last-retailer",lastRetailerCheckTimeoutMilliseconds:3e3,sessionMaxAgeSeconds:1800}}),$cc.module("state").define("stateDebug",["debug"],function(e){function t(t,i,o){var r=document.createElement("div");n.appendChild(r),r.style.width="33.33%",r.style.minWidth="400px",r.style["float"]="left",r.style.padding="0 20px",r.style.borderRight="1px solid #666",r.style.borderBottom="1px solid #666",r.style.boxSizing="border-box",r.style.height="100%",r.style.minHeight="370px";var a=document.createElement("p");a.style.fontStyle="italic",a.style.textAlign="center",a.style.width="100%",a.style.marginBottom="20px",a.innerHTML=i,r.appendChild(a);for(var d in o){var s=document.createElement("p");s.style.fontStyle="italic",s.style.marginBottom="0",s.style.textTransform="capitalize",s.innerHTML=d,r.appendChild(s);var c=document.createElement("dl");c.style.marginTop="2px",r.appendChild(c);for(var l in o[d]){var u=document.createElement("dt");u.style["float"]="left",u.innerHTML=l+": ",c.appendChild(u);var p=document.createElement("dd");p.style.marginLeft="110px",p.innerHTML="&nbsp;",p.id="cc-debug-"+e.dashSeparate(t)+"-"+e.dashSeparate(d)+"-"+e.dashSeparate(l),c.appendChild(p),o[d][l]=p}}}function i(t,i){if(e.isInDebugMode())for(var n in i){if(null===i[n])for(debugParam in o[t][n])o[t][n][debugParam].innerHTML="&nbsp;";for(var r in i[n])o[t][n][r]&&(o[t][n][r].innerHTML=i[n][r])}}var n=null,o=null;return e.isInDebugMode()&&(o={evaluatedState:{shopper:{id:null,known:null,anonymous:null},session:{id:null,ageSeconds:null},conSession:{id:null,ageSeconds:null},impression:{id:null,ageSeconds:null,eventCount:null}},firstParty:{shopper:{id:null,known:null},session:{id:null,startTime:null,lastEventTime:null},conSession:{id:null,startTime:null},cookies:{shopperId:null}},thirdParty:{shopper:{id:null,known:null},session:{id:null,startTime:null,lastEventTime:null},conSession:{id:null,startTime:null},cookies:{shopperId:null}}},n=document.createElement("div"),e.createView("state",n),t("evaluatedState","Evaluated State",o.evaluatedState),t("firstParty","First Party State",o.firstParty),t("thirdParty","Third Party State",o.thirdParty)),{updateParams:i}}),$cc.module("state").define("stateUtil",["uuid"],function(e){function t(){return e.v4()}function i(){return Math.round((new Date).getTime()/1e3)}function n(e){return Math.floor((new Date).getTime()/(1e3*e))}(new Date).getTime();return{generateUUID:t,getTimeSeconds:i,getCurrentEpoch:n}}),$cc.module("state").define("Shopper",["stateUtil","debug"],function(e,t){var i=function(i){var n=i.anonymous;i.id||t.log("Created new shopper id");var o=i.id||e.generateUUID(),r=i.known||!1,a=i.lastRetailerChecked||!1;this.getId=function(){return o},this.isAnonymous=function(){return n},this.isKnown=function(){return r},this.getLastRetailerChecked=function(){return a},this.setKnown=function(e){r=e},this.setLastRetailerChecked=function(e){a=e}};return i}),$cc.module("state").define("ConSession",["stateConfig","stateUtil"],function(e,t){var i=function(e){var i,n;e?(i=e.id,n=e.startTime):(i=t.generateUUID(),n=t.getTimeSeconds()),this.getAgeSeconds=function(){return t.getTimeSeconds()-n},this.getId=function(){return i},this.getStartTime=function(){return n}};return i}),$cc.module("state").define("Session",["stateConfig","stateUtil","debug"],function(e,t,i){var n=function(n){function o(n){i.isInDebugMode()&&(e.sessionMaxAgeSeconds=i.getSetting("sessionMaxAgeSeconds")),n&&e.sessionMaxAgeSeconds>t.getTimeSeconds()-n.lastEventTime?(r=n.id,a=n.startTime,d=n.lastEventTime):(r=t.generateUUID(),a=t.getTimeSeconds(),d=a)}var r,a,d;this.getAgeSeconds=function(){return t.getTimeSeconds()-a},this.getId=function(){return r},this.getStartTime=function(){return a},this.getLastEventTime=function(){return d},this.hasExpired=function(){var i=t.getTimeSeconds()-d;return i>=e.sessionMaxAgeSeconds},this.setId=function(e){r=e},this.recordLastEventTime=function(){d=t.getTimeSeconds()},o(n)};return n}),$cc.module("state").define("Impression",["stateUtil"],function(e){var t=function(){var t=e.generateUUID(),i=0,n=e.getTimeSeconds();this.getAgeSeconds=function(){return e.getTimeSeconds()-n},this.getId=function(){return t},this.getEventCount=function(){return i},this.incrementEventCount=function(){i+=1}};return t}),$cc.module("state").define("firstPartyStoredStateService",["stateConfig","stateDebug","debug"],function(e,t,i){function n(){var i=window.localStorage.getItem(e.localStorageKey);if(!i)return null;var n=JSON.parse(i);return n&&n[l]?(t.updateParams("firstParty",n[l].global),n[l].global||null):null}function o(n){versionedData={},versionedData["v"+e.version]={global:n};try{window.localStorage.setItem(e.localStorageKey,JSON.stringify(versionedData))}catch(o){i.log("An exception was thrown when attempting to set local storage, are you in private mode on safari?")}t.updateParams("firstParty",n)}function r(){var i=new RegExp("(?:(?:^|.*;\\s*)"+e.shopperIdCookieName+"\\s*\\=\\s*([^;]*).*$)|^.*$"),n=document.cookie.replace(i,"$1");return t.updateParams("firstParty",{cookies:{shopperId:n}}),n||null}function a(i){var n=new Date;n.setFullYear(n.getFullYear()+10),document.cookie=e.shopperIdCookieName+"="+i+"; expires="+n.toGMTString()+"; max-age=315569260; path=/",t.updateParams("firstParty",{cookies:{shopperId:i}})}function d(){document.cookie=e.shopperIdCookieName+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",t.updateParams("firstParty",{cookies:{shopperId:null}})}function s(){window.localStorage.removeItem(e.localStorageKey),t.updateParams("firstParty",{shopper:null,session:null,conSession:null})}function c(){var t=new RegExp("(?:(?:^|.*;\\s*)"+e.firstPartyRetailerCookieName+"\\s*\\=\\s*([^;]*).*$)|^.*$"),i=document.cookie.replace(t,"$1");return!!i}var l="v"+e.version;return i.isInDebugMode()&&(i.newSettingsSection(),i.addAction("Remove first party local storage",s),i.addAction("Remove first party shopper id cookie",d)),{getStoredState:n,setStoredState:o,getShopperIdCookie:r,setShopperIdCookie:a,checkRetailerCookieExists:c}}),$cc.module("state").define("thirdPartyStoredStateService",["stateConfig","commService","stateDebug","debug"],function(e,t,i,n){function o(e,i,o){!A||i?(n.log(i?"Force loading of third party iframe":"Loading third party iframe"),w=o,t.unregisterListener("cc-tp-ready"),t.unregisterListener("cc-unexpected-state-change"),t.registerListener("cc-tp-ready",r),t.registerListener("cc-unexpected-state-change",a),b=y(e)):o()}function r(e){x=e.anonymous,S=e.trackingDisabled,I=e.storedState,retailerCookieExists=e.retailerCookieExists,C=e.shopperIdCookie||null,T=e.v2SingleImplicitRetailer,A=!0,n.log("Third party iframe loaded"),C?n.log("Third party shopper id cookie found"):n.log("Third party shopper id cookie not found"),S&&n.log("Tracking is disabled. Analytics events will show in the debug panel, but no requests will be sent"),w()}function a(){k&&k()}function d(){return!(!n.isInDebugMode()||!n.getSetting("anonymous"))||x}function s(){return S}function c(){return retailerCookieExists}function l(){return i.updateParams("thirdParty",{cookies:{shopperId:C}}),C}function u(e){return i.updateParams("thirdParty",I),I}function p(){return T}function f(e,n){C=e,i.updateParams("thirdParty",{cookies:{shopperId:e}}),t.sendMessage(b.contentWindow,"cc-set-shopper-id-cookie",{shopperId:e},n)}function g(){t.sendMessage(b.contentWindow,"cc-remove-shopper-id-cookie",{},function(){i.updateParams("thirdParty",{cookies:{shopperId:null}})})}function m(){t.sendMessage(b.contentWindow,"cc-remove-stored-state",{},function(){i.updateParams("thirdParty",{shopper:null,session:null,conSession:null})})}function h(e,n,o){k=o,i.updateParams("thirdParty",e),t.sendMessage(b.contentWindow,"cc-set-stored-state",e,n)}function y(t){var i,n=document.getElementById(e.thirdPartyIframeId);n?(i=n.parentNode,i.removeChild(n)):(i=document.createElement("div"),i.style="display:none;",document.body.appendChild(i));var o=document.createElement("iframe");return o.id=e.thirdPartyIframeId,o.width=0,o.height=0,o.setAttribute("style","display: none;"),o.src=t,i.appendChild(o),o}function v(){t.unregisterListener("cc-tp-ready")}var b,w,k,x=null,S=null,C=null,I=null,T=null,A=!1;return n.isInDebugMode()&&(n.addAction("Remove third party local storage",m),n.addAction("Remove third party shopper id cookie",g)),{load:o,getStoredState:u,setStoredState:h,getShopperIdCookie:l,setShopperIdCookie:f,getAnonymous:d,getTrackingDisabled:s,destroy:v,checkRetailerCookieExists:c,getV2SingleImplicitRetailer:p}}),$cc.module("state").define("storedStateService",["stateConfig","firstPartyStoredStateService","thirdPartyStoredStateService","debug"],function(e,t,i,n){function o(o,r){f=!!o.thirdPartyOnly,n.isInDebugMode()&&(f=n.getSetting("thirdPartyOnly")),i.load(e.thirdPartyUrl,!!o.force,function(){var e=t.getStoredState(),s=i.getStoredState();n.log("First party stored state "+(e?"found":"not found")),n.log("Third party stored state "+(s?"found":"not found"));var c={shopper:d(e,s),conSession:a("conSession",e,s),session:a("session",e,s)};r(c,o)})}function r(e,o,r,a,d){var s={shopper:{id:e.getId(),known:e.isKnown()},conSession:o?{id:o.getId(),startTime:o.getStartTime()}:null,session:{id:r.getId(),startTime:r.getStartTime(),lastEventTime:r.getLastEventTime()}};e.getLastRetailerChecked()&&(s.shopper.lastRetailerChecked=e.getLastRetailerChecked());var c=t.getShopperIdCookie(),l=i.getShopperIdCookie();s.shopper.id=c||l||s.shopper.id,c||f||(n.log("First party shopper id cookie set"),t.setShopperIdCookie(s.shopper.id)),l&&l===s.shopper.id||i.setShopperIdCookie(s.shopper.id),(i.getAnonymous()&&!f||null!==t.getStoredState())&&t.setStoredState(s),i.setStoredState(s,a,d)}function a(e,n,o){var n=n?n[e]:null,o=o?o[e]:null;return t.getShopperIdCookie()===i.getShopperIdCookie()?o||n||null:n||o||null}function d(e,t){var n={id:s(e,t),anonymous:i.getAnonymous(),lastRetailerChecked:c(e,t)},o=a("shopper",e,t);return o&&(n.known=o.known),n}function s(e,o){var r=t.getShopperIdCookie();n.log("First party shopper id cookie "+(r?"found":"not found"));var a=i.getShopperIdCookie();n.log("Third party shopper id cookie "+(a?"found":"not found"));var d=r||(e?e.shopper.id:a)||(o?o.shopper.id:null);return d}function c(e,t){return e?e.shopper.lastRetailerChecked:t?t.shopper.lastRetailerChecked:null}function l(){return i.getTrackingDisabled()}function u(){return i.getV2SingleImplicitRetailer()}function p(){return i.checkRetailerCookieExists()||t.checkRetailerCookieExists()}var f=!1;return{getStoredState:o,setStoredState:r,getTrackingDisabled:l,getV2SingleImplicitRetailer:u,checkRetailerCookieExists:p}}),$cc.module("state").define("stateService",["stateConfig","storedStateService","Shopper","ConSession","Session","Impression","jsonp","stateDebug","debug"],function(e,t,i,n,o,r,a,d,s){function c(){return C?{shopper:{id:A.getId(),anonymous:A.isAnonymous(),known:A.isKnown()},conSession:E?{id:E.getId(),ageSeconds:E.getAgeSeconds()}:null,session:{id:D.getId(),ageSeconds:D.getAgeSeconds()},impression:{id:M.getId(),eventCount:M.getEventCount(),ageSeconds:M.getAgeSeconds()}}:null}function l(e,i){return C?(e.newImpression&&(s.log("Loading state with new impression"),M=new r),void i()):S?void T.push(i):(s.log("Loading state"),S=!0,T.push(i),void t.getStoredState({thirdPartyOnly:e.thirdPartyOnly},u))}function u(e,a){A=new i(e.shopper),D=new o(e.session),M=new r,E=null;var d=t.checkRetailerCookieExists();return A.known||d&&A.setKnown(!0),e.conSession||d||A.getLastRetailerChecked()||A.anonymous||36===A.getId().length&&"0"===A.getId().charAt(0)?e.conSession?void f(function(t){t&&(E=new n(e.conSession)),p(a)}):void p(a):void g(function(){p(a)})}function p(e){v(function(){C=!0,S=!1,d.updateParams("evaluatedState",c()),s.log("State loaded");for(var e=0;e<T.length;e++)T[e]()},function(){I?s.log("Unexpected third party state change occurred after attempting to load again. Giving up."):(s.log("Unexpected third party state change occurred. Attempting to load again using new third party state."),I=!0,e.force=!0,t.getStoredState(e,u))})}function f(t){s.log("Connected session found, checking if it is still active");var i=e.conSessionCheckUrl;i+=(/\?/.test(i)?"&":"?")+"cb="+Math.floor((new Date).getTime()/3e5),a.request(e.conSessionCheckUrl,function(e){s.log(e.loggedIn?"Connected session is still active":"Connected session has expired"),t(e.loggedIn)},function(){s.log("Check for connected session timed out, assume it is still active"),t(!0)},e.conSessionCheckTimeoutMilliseconds)}function g(t){s.log("Checking if the shopper has a last retailer we are not aware of");var i=e.lastRetailerCheckUrl;i+=(/\?/.test(i)?"&":"?")+"cb="+Math.floor((new Date).getTime()/3e5),a.request(i,function(e){e&&e.last_retailer_set&&(A.setKnown(!0),"implicit"===e.last_retailer_set&&(L=!0)),A.setLastRetailerChecked(!0),t()},function(){s.log("Check if the shopper has a last retailer we are not aware of timed out"),t()},e.lastRetailerCheckTimeoutMilliseconds)}function m(){E||(s.log("Connected session created"),E=new n,v())}function h(){s.log("Connected session removed"),E=null,v()}function y(e){s.log("Shopper set as "+(e?"known":"unknown")),A.setKnown(e),v()}function v(e,i){t.setStoredState(A,E,D,e,i)}function b(){M.incrementEventCount(),D.hasExpired()?D=new o:D.recordLastEventTime(),v()}function w(){return t.getTrackingDisabled()}function k(){return t.getV2SingleImplicitRetailer()}function x(){return L}var S=!1,C=!1,I=!1,T=[],A=null,E=null,D=null,M=null,L=!1;return s.newSettingsSection(),s.addAction("Create connected shopper state",m),s.addAction("Remove connected shopper state",h),s.addAction("Set shoppper known",function(){y(!0)}),s.addAction("Set shoppper unknown",function(){y(!1)}),{getState:c,loadState:l,createConSession:m,removeConSession:h,setShopperKnown:y,updateStateWithNewEvent:b,getTrackingDisabled:w,getV2SingleImplicitRetailer:k,getImplicitRetailerSet:x}}),$cc.module("state").define("stateApi",["commService","stateService"],function(e,t){function i(e,i){t.loadState({},function(){i(t.getState())})}function n(e,i){t.createConSession(),i()}function o(e,i){t.removeConSession(),i()}function r(e,i){t.setShopperKnown(!0),i()}function a(e,i){t.setShopperKnown(!1),i()}function d(e,i){i(t.getV2SingleImplicitRetailer())}e.registerListener("cc-state-get-state",i),e.registerListener("cc-state-set-shopper-known",r),e.registerListener("cc-state-set-shopper-unknown",a),e.registerListener("cc-state-create-con-session",n),e.registerListener("cc-state-remove-con-session",o),e.registerListener("cc-state-get-v2-single-implicit-retailer",d)}),$cc.module("analytics",["comm","state","debug"]),$cc.module("analytics").define("analyticsConfigDefault",[],function(){return{api:{version:"2",host:"//qa-analytics.constant.co"}}}),$cc.module("analytics").define("analyticsConfig",["analyticsConfigDefault"],function(e){return e}),$cc.module("analytics").define("analyticsDebug",["debug"],function(e){function t(e){var t=document.createElement("div");return n.appendChild(t),t.style["float"]="left",t.style.padding="0 20px",t}function i(t){if(e.isInDebugMode()){e.bringToFront(),e.incrementNum("analytics");var i=document.createElement("p");i.innerHTML=e.getFormattedTime()+" ->",i.innerHTML+=' Event context: "'+t.data.event.eventContext+'"',i.innerHTML+=', Event type: "'+t.data.event.type+'"',i.innerHTML+=", Shopper state: "+t.data.event.shopperState,i.innerHTML+=", Store id: "+t.data.event.storeId,i.innerHTML+=', Tracked action: "'+t.data.event.trackedAction+'"',i.style.marginBottom="2px";var n=document.createElement("span");n.innerHTML="show full",n.style.textDecoration="underline",n.style.cursor="pointer",n.style.display="block";var r=document.createElement("pre");r.style.display="none",r.style.backgroundColor="#333",r.style.marginTop="0px",r.innerHTML=JSON.stringify(t,null,2),n.onclick=function(){"none"===r.style.display?(r.style.display="block",n.innerHTML="hide full"):(r.style.display="none",n.innerHTML="show full")},i.appendChild(n),o.appendChild(i),o.appendChild(r)}}var n=null,o=null;return e.isInDebugMode()&&(n=document.createElement("div"),e.createView("analytics",n),o=t("request","Requests")),{addRequest:i}}),$cc.module("analytics").define("analyticsService",["stateService","analyticsConfig","analyticsDebug","debug"],function(e,t,i,n){function o(t,n,r,d,l,u){e.loadState({},function(){e.updateStateWithNewEvent();var p={event:l,state:e.getState()};u&&(p.state.experiment={id:u.id,variation:u.variation}),i.addRequest({projectId:t,sourceId:n,sourceVersion:r,dataVersion:d,data:p}),e.getTrackingDisabled()||s(p,a(t,n,r,d)),1===++c&&e.getImplicitRetailerSet()&&o(t,n,r,d,{eventContext:"other",type:"retailer-select-implicit",projectId:l.projectId,storeId:l.storeId,shopperState:l.shopperState,appContext:l.appContext})})}function r(){return"withCredentials"in new XMLHttpRequest}function a(e,i,n,o){var r=t.api.host+"/track/v"+t.api.version+"/event";return r+="?cid="+d(e),r+="&v="+d(o),r+="&sid="+d(i),r+="&sv="+d(n)}function d(e){return e=e.toString().replace(".","-"),encodeURI(e)}function s(e,t){var i=r?new XMLHttpRequest:new XDomainRequest;i.open("POST",t),i.send(JSON.stringify(e))}var c=0;return{trackEvent:o}}),$cc.module("analytics").define("analyticsApi",["commService","analyticsService","debugApi"],function(e,t,i){function n(e,i){var n=e.event;n.appContext=e.appContext,n.projectId=e.projectId,t.trackEvent(e.projectId,e.sourceId,e.sourceVersion,e.dataVersion,n,e.experiment),i(null)}e.registerListener("cc-analytics-track-event",n)}),$cc.module("cookies").define("cookies",[],function(){var e={get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t,i,n,o,r){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(i)switch(i.constructor){case Number:a=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:a="; expires="+i;break;case Date:a="; expires="+i.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+a+(o?"; domain="+o:"")+(n?"; path="+n:"")+(r?"; secure":""),!0},remove:function(e,t,i){return!(!e||!this.has(e))&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0)},has:function(e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}};return e}),$cc.module("experiment",["comm"]),$cc.module("experiment").define("experimentConfig",[],function(){return{localStorageKey:"$cc_experiment"}}),$cc.module("experiment").define("experiment",["experimentConfig"],function(e){function t(){try{return localStorage.setItem("$cc_test","cc_test"),localStorage.removeItem("$cc_test"),!0}catch(e){return!1}}function i(e){var t=n();return t?t[e]||null:null}function n(){var t=localStorage.getItem(e.localStorageKey);if(t)try{return JSON.parse(t)||{}}catch(i){}return{}}function o(t,i,o,r,a){var d=n();d[t]={chosen:i,normalized:o,data:r,timestamp:a},localStorage.setItem(e.localStorageKey,JSON.stringify(d))}function r(t){var i=n();i[t]=void 0,localStorage.setItem(e.localStorageKey,JSON.stringify(i))}function a(t){localStorage.removeItem(e.localStorageKey)}return{canParticipate:t,getExperiment:i,getAllExperiments:n,setExperiment:o,removeExperiment:r,removeAllExperiments:a}}),$cc.module("experiment").define("experimentApi",["commService","experiment"],function(e,t){function i(e,i){i({experiments:t.getAllExperiments(),canParticipate:t.canParticipate()})}function n(e,i){t.setExperiment(e.name,e.chosen,e.normalized,e.data,e.timestamp),i()}e.registerListener("cc-experiment-get-experiments",i),e.registerListener("cc-experiment-set-experiment",n)}),$cc.module("activity",["comm"]),$cc.module("activity").define("activityConfig",[],function(){return{localStorageKey:"$cc_activity"}}),$cc.module("activity").define("activity",["activityConfig"],function(e){function t(){try{return localStorage.setItem("$cc_test","cc_test"),localStorage.removeItem("$cc_test"),!0}catch(e){return!1}}function i(e){var t=n();return t?t[e]||null:null}function n(){try{var t=localStorage.getItem(e.localStorageKey);if(t)return JSON.parse(t)||{}}catch(i){}return{}}function o(t,i,o,r){var a=n();a[t]={normalized:i,data:o,timestamp:r};try{localStorage.setItem(e.localStorageKey,JSON.stringify(a))}catch(d){}}function r(t){var i=n();i[t]=void 0,localStorage.setItem(e.localStorageKey,JSON.stringify(i))}function a(t){try{localStorage.removeItem(e.localStorageKey)}catch(i){}}return{canParticipate:t,getActivity:i,getAllActivities:n,setActivity:o,removeActivity:r,removeAllActivities:a}}),$cc.module("activity").define("activityApi",["commService","activity"],function(e,t){function i(e,i){i({activities:t.getAllActivities(),canParticipate:t.canParticipate()})}function n(e,i){t.setActivity(e.name,e.normalized,e.data,e.timestamp),i()}e.registerListener("cc-activity-get-activities",i),e.registerListener("cc-activity-set-activity",n)}),$cc.module("widgetHandler",["comm","state","analytics","public","debug","cookies","experiment","activity"]),$cc.module("widgetHandler").define("widgetHandlerConfig",["stateConfig","analyticsConfig","debugConfig"],function(e,t,i){return e.conSessionCheckUrl="https://service.foodity.com/api/auth",t.api.version="2",t.api.host="//euwest-analytics.constant.co",i.stylesheetUrl="//static.foodity.com/state/cc-debug.css",{host:"https://service.foodity.com",foodityUrl:"",apiUrl:"/api/widget/"}}),$cc.module("widgetHandler").define("widgetHandler",["widgetHandlerConfig","stateService","analyticsService","publicApi","debug","cookies"],function(e,t,i,n,o,r){var a,d,s,c,l=function(){function i(){return n()?(a(),void s()):(d("error","Browser not compatible"),void disableStatic())}function n(){return"JSON"in window&&"querySelectorAll"in document&&"querySelector"in document}function a(){if(!le&&void 0===window.constantCoHost){var e=document.getElementsByTagName("SCRIPT");if(e&&e.length)for(var t in e)e[t].src&&e[t].src.match(/foodity(\-[0-9]\.[0-9])?\.js/)&&(le=e[t].src.match(/^https?:\/\/[^\/]+/)[0])}window.constantCoHost&&(le=window.constantCoHost),ue=le+ue,pe=le+pe}function d(e,t){o.log("Widget Handler: "+t)}function s(){void 0!==window.lazyLoad?(c(),f()):(p(),l()),G(),window.onbeforeunload=function(){if(De)return"You can close this browser window, but the items you asked us to add to your basket will still be added. Close this window?"}}function c(){var e=document.querySelectorAll(Ae),t=k(),i=document.documentElement.scrollTop||document.body.scrollTop,n=i,o=i+t.height+t.height/2;if(e&&e.length)for(var r=0;r<e.length;r++){var a=e[r];if(!a.getAttribute("data-uid")){var d=h(a);d.y>=n&&d.y<o&&T(a)}}}function l(){var e=document.querySelectorAll(Ae);if(e&&e.length)for(var t=0;t<e.length;t++){var i=e[t];i.getAttribute("data-uid")||T(i)}}function p(){if("undefined"!=typeof window.constantCoAppId)switch(window.constantCoAppId){case"7bzsSDBP9J":}}function f(){g("scroll",window,function(){
clearTimeout(ge),ge=window.setTimeout(c,100)})}function w(e){return e?"object"==typeof e&&("object"!=typeof e||"getAttribute"in e)||(d("error","Expecting DOM object"),!1):(d("error","Element does not exist"),!1)}function x(e,t){var i=e.getAttribute("data-uid");if(!i)return d("error",e.outerHTML+" not a ConstantCo widget"),!1;var n=e.getAttribute("data-type");return t===n||(d("error",n+" is not the expected type "+t),!1)}function T(e){var i=e.getAttribute("data-type"),n=e.getAttribute("data-option"),o=e.getAttribute("data-app-id"),a=e.getAttribute("data-app-resource-id"),d=e.getAttribute("data-width"),s=e.getAttribute("data-height"),c=e.getAttribute("data-json"),l=e.getAttribute("data-host"),u=e.getAttribute("data-params");if(o||void 0===window.constantCoAppId||(o=window.constantCoAppId),!i||!o)return null;if("initoverlay"==i&&r.get(Ee.init_overlay))return null;var p={btn_uid:I(),app_id:o,app_type:i};if(a&&(p.app_resource_id=a),c&&(p.json=decodeURIComponent(c)),p.cc_r=r.get(Ee.last_retailer),p.session=t.getState().shopper.id,u)for(var f=u.split("|"),g=0;g<f.length;g++){var m=f[g].split("=");1===m.length&&(m[1]=1),p[m[0]]=m[1]}"undefined"==typeof p.mobile_breakpoint&&(p.mobile_breakpoint=0);var h=e;h.setAttribute("data-uid",p.btn_uid),h.cWidth=d,h.cHeight=s,h.setAttribute("data-mobilebreakpoint",p.mobile_breakpoint),p.window_width=k().width;var y=pe+"wrapper/"+o+"/"+i+".html";return l&&(y=l),n&&(y+="/"+n),p.tmp_hash=fe,h.innerHTML='<iframe allowtransparency="true" frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" id="foodity-btn-'+p.btn_uid+'" tabindex="0" vspace="0" style="width:0;height:0;"></iframe>',h.firstChild.src=y+"?"+b(p)+"#"+encodeURIComponent(document.location.href),h}function A(e){if(!e.app_id)return!1;var t=ce('[data-uid="'+e.btn_uid+'"]');if(t){t.fdty=e,t.fdty.width=e.width=t.cWidth||e.width||"100%",t.fdty.height=e.height=t.cHeight||e.height,t.fdty.assocWidgets=[];var i=t.fdty.width.toString().match(/%/)?t.fdty.width:t.fdty.width+"px";return t.firstChild.setAttribute("style","min-width:"+i+";width:0;height:"+e.height+"px;"),e.app_resource_id&&se("resource-info-load-resource-id-"+e.app_resource_id,e),t.fdty.mobileBreakpoint=t.getAttribute("data-mobilebreakpoint"),t.fdty.isDesktopView=!0,t.removeAttribute("data-mobilebreakpoint"),J(e.btn_uid),!0}}function E(e){var t;return e.targetWidget?(t=ce('[data-uid="'+e.targetWidget+'"]'),t||(t=ce('[data-type="'+e.targetWidget+'"]'))):t=ce('[data-uid="'+e.btn_uid+'"]'),t?void(t.fdty.isAssocWidget?(J(t.getAttribute("data-uid")),K(t.getAttribute("data-uid"),e)):e.noAnimation||!Be?t.firstChild.style.height=e.height+"px":Be(t.firstChild).stop().animate({height:e.height+"px"},1e3)):void d("error","Element not found")}function D(e){var t=ce('[data-uid="'+e.btn_uid+'"]');if(!t)return void d("error","Element not found");if(void 0===t.fdty.assocWidgets)return void d("error","No associated widgets found");var i=[];if(e.targetWidgets)for(var n=0;n<e.targetWidgets.length;n++)for(var o=0;o<t.fdty.assocWidgets.length;o++){var r=ce('[data-uid="'+t.fdty.assocWidgets[o]+'"]');if(r.getAttribute("data-type")==e.targetWidgets[n]){i.push(t.fdty.assocWidgets[o]);break}}else i=t.fdty.assocWidgets;if(void 0===e.task)return void d("error","No task defined");for(var n=0;n<i.length;n++){var a=ce('[data-uid="'+i[n]+'"]');if(a){var s=ce("iframe",a),c={action:e.task,cacheBust:+new Date+u++};void 0!==e.taskData&&(c.data=e.taskData,a.fdty.data=e.taskData),Re.postMessage(JSON.stringify(c),s.src,s.contentWindow)}}}function M(e){var t=ce('[data-uid="'+e.btn_uid+'"]');if(!t)return void d("error","Element not found");if(e.data&&e.data.name&&Ee[e.data.name]){var i="";if(e.data.key){i=r.get(Ee[e.data.name]);var n={};if(i)for(var o=i.split(";"),a=0;a<o.length;a++){var s=o[a].split("=");n[s[0]]=s[1]}n[e.data.key]=e.data.value,i="";for(var c in n)i&&(i+=";"),i+=c+"="+n[c]}else i=e.data.value;var l=null;e.data.expires&&(l="Infinity"==e.data.expires?1/0:new Date(+new Date+864e5*e.data.expires)),r.set(Ee[e.data.name],i,l,"/")}}function L(e){var t=ce('[data-uid="'+e.btn_uid+'"]');return t?void(e.data&&e.data.name&&Ee[e.data.name]&&r.remove(Ee[e.data.name],"/")):void d("error","Element not found")}function _(e){var t=ce('[data-uid="'+e.btn_uid+'"]');if(!t)return void d("error","Element not found");var i=document.querySelectorAll(Ae);if(i&&i.length)for(var n=0;n<i.length;n++){var t=i[n];if(t.getAttribute("data-uid")){var o=ce("iframe",t),r={action:"selectretailer",cacheBust:+new Date+u++,data:{id:e.data.value}};Re.postMessage(JSON.stringify(r),o.src,o.contentWindow)}}for(var n=0;n<we.length;n++){var a=ce('[data-uid="'+we[n]+'"]');a||(a=ce('[data-type="'+we[n]+'"]'));var o=ce("iframe",a),r={action:"selectretailer",cacheBust:+new Date+u++,data:{id:e.data.value}};Re.postMessage(JSON.stringify(r),o.src,o.contentWindow)}}function B(e){var t=ce('[data-uid="'+e.btn_uid+'"]');if(!t)return void d("error","Widget does not exist");switch(e.type){case"show-stores":F(e.btn_uid,t,e.type)}}function R(e){var t=e.y==-1?document.body:ce('[data-uid="'+e.btn_uid+'"]');if(t){var i=h(t);Be&&e.y!=-1&&e.animate!==!1?Be("html, body").animate({scrollTop:i.y+e.y},1e3):window.scrollTo(0,i.y+e.y)}return!0}function W(e){if(!e.targetWidget||!e.targetWidget.length)return void d("error","no widgets to kill provided");var t=ce('[data-uid="'+e.targetWidget+'"]');if(t||(t=ce('[data-type="'+e.targetWidget+'"]')),t){for(var i=t.getAttribute("data-type"),n=t.getAttribute("data-uid"),o=t.fdty.assocWidgets,a=0;a<o.length;a++){var s=ce('[data-uid="'+o[a]+'"]'),c=s.fdty.assocWidgets,l=c.indexOf(n),p=ce("iframe",s),f={action:"destroyed-widget",cacheBust:+new Date+u++,data:{widgetName:t.getAttribute("data-type"),customData:e.customData}};Re.postMessage(JSON.stringify(f),p.src,p.contentWindow),c.splice(l,1)}var g=we.indexOf(n);we.splice(g,1),t.fdty.hasBackdrop&&H(t),"initoverlaycontent"==i&&(r.get(Ee.init_overlay)||r.set(Ee.init_overlay,"1",new Date(+new Date+12096e5),"/")),t.parentNode.removeChild(t),document.getElementsByTagName("body")[0].style.position="inherit",document.getElementsByTagName("body")[0].style.overflow="inherit"}return!0}function P(e){var t;if("undefined"!=typeof e.thirdPartyCookies)e.thirdPartyCookies&&!_e?O(e):(e.urlParams.force_view="mobile",t=e.url+"?"+b(e.urlParams),oe(t));else{var i=Me?e.url+"/mobile/"+e.storeId:e.url+"/web/"+e.storeId;Me||Le?(t=i+"?"+b(e.urlParams)+"#"+encodeURIComponent(document.location.href),oe(t)):(e.url=i,e.styleBorderColor=Te[e.storeId],O(e))}}function N(e){var t="?";for(var i in e["event-data"])t+=i+"="+e["event-data"][i]+"&";t+=(new Date).getTime();var n=new Image;n.src=e.url+t}function O(e){var i=ce('[data-uid="'+e.btn_uid+'"]');if(!i)return void d("error","master element not found");if(e.preHooks&&e.preHooks.destroyWidgets)for(var n,o=0;o<e.preHooks.destroyWidgets.length;o++)for(var a=0;a<we.length;a++)n=ce('[data-uid="'+we[a]+'"]'),n.getAttribute("data-type")==e.preHooks.destroyWidgets[o]&&W({targetWidget:we[a]});if(i.fdty.assocWidgets.length&&("undefined"==typeof e.doNotDestroyAssocWidgets||!e.doNotDestroyAssocWidgets))for(var o=0;o<i.fdty.assocWidgets.length;o++){var s={targetWidget:i.fdty.assocWidgets[o]};W(s)}var c=e.appType;if(!c)return void d("error","No assoc app type supplied");var l=e.app_id;if(!l)return void d("error","No app id supplied");var u=e.url;if(!u)return void d("error","No assoc app URL supplied");var p="undefined"!=typeof e.mobileBreakpoint?e.mobileBreakpoint:0,f={app_id_assoc:l,btn_uid:I(),app_type:c,app_resource_id:"undefined"!=typeof e.appResourceId?e.appResourceId:"",mobile_breakpoint:p,custom_data:"undefined"!=typeof e.customData?e.customData:"",tracking_context:"undefined"!=typeof e.trackingContext?e.trackingContext:"",window_width:k().width,cc_r:r.get(Ee.last_retailer),session:t.getState().shopper.id},g="undefined"!=typeof e.urlParams?e.urlParams:{};if(g)for(var m in g)f[m]=g[m];var h="undefined"!=typeof e.renderToParent&&e.renderToParent,y="undefined"==typeof e.hasBackdrop||e.hasBackdrop,v="undefined"!=typeof e.canDestroy?e.canDestroy:y,w="undefined"!=typeof e.canCloseOnOuterClick?e.canCloseOnOuterClick:y,x="undefined"!=typeof e.styleBackdropColor?e.styleBackdropColor:xe,S="undefined"!=typeof e.styleBackdropOpacity?e.styleBackdropOpacity:Se,C="undefined"!=typeof e.styleBackdropZindex?e.styleBackdropZindex:Ce,T="undefined"!=typeof e.styleBgColor?e.styleBgColor:"transparent",A="undefined"!=typeof e.styleBorderColor?e.styleBorderColor:"transparent",E="undefined"!=typeof e.styleBorderWidth?e.styleBorderWidth:0,D="undefined"!=typeof e.styleBorderRadius?e.styleBorderRadius:10,M="undefined"!=typeof e.styleZindex?e.styleZindex:Ce,L='<iframe allowtransparency="true" frameborder="0" hspace="0" marginheight="0" marginwidth="0" tabindex="0" vspace="0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; outline: 0; opacity: 0;" onload="this.style.opacity = 1;"></iframe>',_=document.createElement("div");_.setAttribute("data-cco-object-type","iframecontainer");var B="undefined"!=typeof e.behaviorDesktop?e.behaviorDesktop:"dynamic",R="undefined"!=typeof e.positionDesktop?e.positionDesktop:{},P="undefined"!=typeof e.behaviorMobile?e.behaviorMobile:"mobile";_.innerHTML=L,_.firstChild.src=u+"?"+b(f)+"#"+encodeURIComponent(document.location.href);var N=!(parseInt(f.window_width,10)<parseInt(f.mobile_breakpoint,10));N||"mobileaffix"!=P||(e.height=0);var O=document.createElement("div");if(O.setAttribute("data-type",c),O.setAttribute("data-uid",f.btn_uid),O.fdty={btn_uid:f.btn_uid,assocWidgets:[i.getAttribute("data-uid")],behaviorDesktop:B,positionDesktop:R,behaviorMobile:P,isAssocWidget:!0,renderToParent:h,hasBackdrop:y,canDestroy:v,canCloseOnOuterClick:w,isDesktopView:N,mobileBreakpoint:p,styleBgColor:T,styleBorderColor:A,styleBorderWidth:E,styleBorderRadius:D,styleZindex:M,styleBackdropColor:x,styleBackdropOpacity:S,styleBackdropZindex:C},y){var H=$(x,S,C);O.appendChild(H)}O.appendChild(_),h?(i.style.position="relative",i.appendChild(O)):document.getElementsByTagName("body")[0].appendChild(O);var j=document.documentElement.scrollTop||document.body.scrollTop;return _.firstChild.contentWindow.focus(),window.scrollTo(0,j),K(f.btn_uid,e),i.fdty.assocWidgets.push(f.btn_uid),we.push(f.btn_uid),y&&w&&U(f.btn_uid),!0}function $(e,t,i){var n=document.createElement("div");return n.setAttribute("style","position:fixed; -webkit-transform: translateZ(0); top:0;left:0;width:100%;height:100%;background-color:"+e+";opacity:"+t+";filter:alpha(opacity="+parseInt(100*t,10)+");z-index:"+i),n.setAttribute("data-cco-object-type","backdrop"),n.style.display="block",n}function H(e){var t=ce('[data-cco-object-type="backdrop"]',e);t||d("error","No backdrop exists"),m("click",t,function(){}),e.removeChild(t)}function U(e){var t=ce('[data-uid="'+e+'"]');t||d("error","Element could not be found");var i=ce('[data-cco-object-type="backdrop"]',t);i||d("error","No backdrop exists"),g("click",i,function(){j(i)})}function j(e){var t=e.parentElement;if(t.fdty&&t.fdty.canDestroy){var i=ce("iframe",t),n={action:"backdrop-outer-click"};Re.postMessage(JSON.stringify(n),i.src,i.contentWindow)}else{var o={targetWidget:t.getAttribute("data-uid")};W(o)}}function z(){for(var e,t,i=0;i<we.length;i++)e=ce('[data-uid="'+we[i]+'"]'),e||(e=ce('[data-type="'+we[i]+'"]')),t=e.getAttribute("data-uid"),J(t),K(t)}function J(e){var t=ce('[data-uid="'+e+'"]');if(t&&t.fdty){var i=k(),n=t.fdty.isDesktopView,o=!1;if(i.width<t.fdty.mobileBreakpoint?n&&(t.fdty.isDesktopView=!1,o=!0):n||(t.fdty.isDesktopView=!0,o=!0),o){var r=ce("iframe",t),a={action:"switchview",cacheBust:+new Date+u++,data:{isDesktopView:t.fdty.isDesktopView}};Re.postMessage(JSON.stringify(a),r.src,r.contentWindow)}}}function q(){var e=document.querySelectorAll(Ae);if(e&&e.length)for(var t=0;t<e.length;t++){var i=e[t];i.getAttribute("data-uid")&&J(i.getAttribute("data-uid"))}return!0}function K(e,t){if(t=t||{},!e)return void d("error","No appUid supplied");var i,n,o,r,a,s,c,l,u,p=(k(),ce('[data-uid="'+e+'"]')),f=ce('[data-cco-object-type="iframecontainer"]',p),g=document.getElementsByTagName("body")[0];if(t.width?(n=t.width,p.fdty.width=t.width):n=p.fdty.width,t.height?(i=t.height,p.fdty.height=t.height):i=p.fdty.height,t.styleBgColor?(a=t.styleBgColor,p.fdty.styleBgColor=t.styleBgColor):a=p.fdty.styleBgColor,t.styleBorderColor?(s=t.styleBorderColor,p.fdty.styleBorderColor=t.styleBorderColor):s=p.fdty.styleBorderColor,t.styleBorderWidth?(c=t.styleBorderWidth,p.fdty.styleBorderWidth=t.styleBorderWidth):c=p.fdty.styleBorderWidth,t.styleBorderRadius?(l=t.styleBorderRadius,p.fdty.styleBorderRadius=t.styleBorderRadius):l=p.fdty.styleBorderRadius,u=p.fdty.styleZindex,p.fdty.isDesktopView){var m,y;"relative"==p.fdty.behaviorDesktop&&p.fdty.positionDesktop&&(m=ce('[data-uid="'+p.fdty.positionDesktop.basedOn+'"]'),m||(m=ce('[data-type="'+p.fdty.positionDesktop.basedOn+'"]')),y=h(m),"undefined"!=typeof t.positionDesktop?(o=parseInt(Math.round(y.y+t.positionDesktop.offsetTop),10),p.fdty.positionDesktop.offsetTop=t.positionDesktop.offsetTop,r=parseInt(Math.round(y.x+t.positionDesktop.offsetLeft),10),p.fdty.positionDesktop.offsetLeft=t.positionDesktop.offsetLeft):(o=parseInt(Math.round(y.y+p.fdty.positionDesktop.offsetTop),10),r=parseInt(Math.round(y.x+p.fdty.positionDesktop.offsetLeft),10)))}"relative-inline"!=p.fdty.behaviorDesktop&&"relative-inline"!=p.fdty.behaviorMobile||("undefined"!=typeof t.positionDesktop?(p.fdty.positionDesktop.offsetTop=t.positionDesktop.offsetTop,p.fdty.positionDesktop.offsetLeft=t.positionDesktop.offsetLeft):(o=p.fdty.positionDesktop.offsetTop,r=p.fdty.positionDesktop.offsetLeft));var v=p.fdty.isDesktopView?p.fdty.behaviorDesktop:p.fdty.behaviorMobile;switch(v){case"static":f.setAttribute("style","box-sizing: border-box; position: fixed; top: 50%; left: 50%; margin-left: "+n/-2+"px; width: 0; min-width: "+n+"px; margin-top: "+i/-2+"px; height: "+i+"px; z-index:"+u+"; border: "+c+"px solid "+s+"; background-color: "+a+"; border-radius: "+l+"px;"),g.style.position="inherit",g.style.overflow="inherit";break;case"dynamic":f.setAttribute("style","box-sizing: border-box; position: fixed; top: 4%; left: 50%; margin-left: "+n/-2+"px; width: 0; min-width: "+n+"px; height: 90%; z-index:"+u+"; border: "+c+"px solid "+s+"; background-color: "+a+"; border-radius: "+l+"px;"),g.style.position="inherit",g.style.overflow="inherit";break;case"relative":f.setAttribute("style","box-sizing: border-box; position: absolute; top: "+o+"px; left: "+r+"px; width: 0; min-width: "+n+"px; height: "+i+"px; z-index:"+u+"; border: "+c+"px solid "+s+"; background-color: "+a+"; border-radius: "+l+"px;"),g.style.position="inherit",g.style.overflow="inherit";break;case"relative-inline":f.setAttribute("style","box-sizing: border-box; position: absolute; top: "+o+"px; left: "+r+"px; width: 0; min-width: "+n+"px; height: "+i+"px; z-index:"+u+"; border: "+c+"px solid "+s+"; background-color: "+a+"; border-radius: "+l+"px;"),g.style.position="inherit",g.style.overflow="inherit";break;case"mobile":g.style.position="fixed",g.style.overflow="hidden",f.setAttribute("style","box-sizing: border-box; position: fixed; top: 0; bottom: 0; left: 0; height: 100%; width: 0; min-width: 100%; overflow-y: scroll; z-index:"+u+"; -webkit-transform: translateZ("+u+"); -webkit-overflow-scrolling: touch;");break;case"mobileaffix":g.style.position="relative",g.style.overflow="hidden",f.setAttribute("style","box-sizing: border-box; position: fixed; bottom: 0; left: 0; width: 0; min-width: 100%; height: "+i+"px; z-index:"+u+"; -webkit-transform: translateZ("+u+"); overflow: hidden;")}}function V(){var e=ce('[data-type="addtobasket"]'),t={targetWidget:e.getAttribute("data-uid")};W(t)}function F(e,t,i){var n=t.fdty;if(1===n.stores.length&&(!("url"in n)||"url"in n&&n.url.indexOf("smartproduct")===-1))return void(n.url&&n.url.indexOf("smartproduct")!==-1?(n.replacements={store:n.stores[0]},te(n)):displayLegacy(e,n.stores[0],"basket"));var o=document.getElementById("foodity-stores"),r=!1;if(document.getElementById("foodity-stores-iframe")&&(r=e===document.getElementById("foodity-stores-iframe").getAttribute("rel")),o||(o=document.createElement("div"),o.id="foodity-stores",o.setAttribute("style","position:absolute;top:"+n.height+"px;left:8px;width:"+n.width+"px;height:43px"),document.getElementsByTagName("body")[0].appendChild(o)),me&&r&&n)o.style.display="none",o.innerHTML="",me=!1;else if(n){var a={app_resource_type:t.getAttribute("data-type"),app_resource_id:t.getAttribute("data-app-resource-id")};"smartproduct-addtobasket"!==a.app_resource_type&&(a={}),Z(e,n.stores.join("|"),i,n.app_id,a)}else o.style.display="block",o.innerHTML='<div class="foodity-recipe-loading" rel="'+e+'" style="padding: 5px 10px;width: 190px;background-color: white;border: 1px solid #CCC;border: 1px solid rgba(0, 0, 0, 0.2);border-radius: 6px;box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);background-clip: padding-box;">Loading recipe info</div>',me=!0,o.style.height="43px",Q(o,t,i,n.app_id),de("recipe-info-load-resource-id-"+t.getAttribute("data-app-resource-id"),function(t){Z(e,t.stores.join("|"),i,n.app_id)});X()}function Z(e,t,i,n,o){o="object"==typeof o?o:{};var r=document.getElementById("foodity-stores"),a={"btn-uid":e,stores:t,app_id:n};for(var d in o)a[d]=o[d];r.style.display="block",r.style.width||(r.style.width=ce('[data-uid="'+e+'"] iframe').offsetWidth+"px"),r.innerHTML='<iframe src="'+pe+i+"?"+b(a)+"#"+encodeURIComponent(document.location.href)+'" id="foodity-stores-iframe" rel="'+e+'" allowtransparency="true" frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" tabindex="0" vspace="0" width="100%" style="width:100%; height:100%"></iframe>',me=!0,Q(r)}function G(){g("resize",window,function(){me&&Q(),q(),z()})}function Q(e,t){e=e||document.getElementById("foodity-stores"),t=t||ce('[data-uid="'+ce("iframe, div",e).getAttribute("rel")+'"]');var i=h(t),n=k(),o=i.x,r=n.width-t.fdty.width-i.x-S(!0);i.x+200>n.width&&o>r?(e.style.right=n.width-i.x-t.fdty.width-S()+"px",e.style.left=null):(e.style.left=i.x+"px",e.style.right=nuill);var a=parseInt(e.style.height,10),d=document.documentElement.scrollTop||document.body.scrollTop,s=i.y+t.fdty.height-d,c=n.height-C(!0)-s;if(c<a){var l=10;e.style.top=i.y-parseInt(e.style.height,10)+l+"px"}else e.style.top=i.y+t.fdty.height+"px"}function Y(e){document.getElementById("foodity-stores").style.height=e+"px",Q()}function X(){ve||(ve=!0,g("click",document.body,function(){ee()}))}function ee(){if(me){var e=document.getElementById("foodity-stores");e.style.display="none",e.innerHTML="",me=!1}}function te(e){var t=ce('[data-uid="'+e.btn_uid+'"]');if(!t)return void d("error","Requested widget not found");var i=t.fdty,n=ue;void 0!==i.url&&(n+=i.url);var o=!1,r={app_id:i.app_id};if(void 0!==i.fdty_url&&(r.fdty_url=i.fdty_url),void 0!==e.session&&(r.session=e.session),void 0!==e.replacements){n=decodeURIComponent(n);for(var a in e.replacements)n=n.replace("{"+a+"}",e.replacements[a])}void 0!==e.store&&(o=e.store),void 0!==i.data&&(r.data="string"==typeof i.data?i.data:JSON.stringify(i.data)),void 0!==i.forceDesktop&&(r.forceDesktop=i.forceDesktop),void 0!==i.forceMobile&&(r.forceMobile=i.forceMobile);var s=void 0!==i.forceRedirect;n+="?"+b(r)+"#"+encodeURIComponent(document.location.href),ie(n,i,o,s)}function ie(e,t,i,n){var o=void 0!==n&&n||Me&&!t.disableMobileRedirect||Le&&!_e&&!t.disableTabletRedirect;if(o)return void oe(e);var r=t.modalWidth||730,a=t.modalHeight||null,d=t.modalBgColor||"#FFF",s=t.modalBorderColor||(i?Te[i]:"transparent"),c=void 0!==t.modalBorderWidth?t.modalBorderWidth:Ie,l=void 0!==t.modalBorderRadius?t.modalBorderRadius:Ie,u=void 0===t.display_overlay||void 0!==t.display_overlay&&t.display_overlay===!0,p=t.overlay_bg_color||xe,f=t.overlay_bg_opacity||Se;ne('<iframe src="'+e+'" allowtransparency="true" width="100%" height="100%" frameborder="0"></iframe>',r,a,d,s,c,l,u,p,f)}function ne(e,t,i,n,o,r,a,d,s,c){ee(),d&&(ke?(ke.style.backgroundColor=s,ke.style.opacity=c,ke.style.filter="alpha(opacity="+parseInt(100*c,10)+")"):(ke=document.createElement("div"),ke.setAttribute("style","position:fixed;top:0;left:0;width:100%;height:100%;background-color:"+s+";opacity:"+c+";filter:alpha(opacity="+parseInt(100*c,10)+");z-index:2147483647"),document.getElementsByTagName("body")[0].appendChild(ke)),ke.style.display="block");var l,u=0;be=document.createElement("div"),_e?(l="50px",i=i+"px"||"600px"):(i?(l="50%",u="-"+i/2+"px",i+="px"):(l="4%",i="90%"),g("mousewheel",be,function(e){try{e.preventDefault()}catch(e){}return!1})),be.setAttribute("style","position:fixed;top:"+l+";left:50%;width:"+t+"px;height:"+i+";margin-left:-"+t/2+"px;margin-top:"+u+";border:"+r+"px solid "+o+";border-radius:"+a+"px;background-color:"+n+";-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;z-index:2147483647"),be.innerHTML='<div style="position:absolute;top:-9999px;left:-9999px">Modalled overlay</div>'+e,document.getElementsByTagName("body")[0].appendChild(be).focus()}function oe(e){window.top.location.href=e}function re(){ae(),he=!1}function ae(){ke&&(ke.style.display="none"),be&&be.parentNode.removeChild(be)}function de(e,t){ye[e]||(ye[e]=[]),ye[e].push(t)}function se(e,t){if(ye[e])for(var i=ye[e],n=0,o=i.length;n<o;n++)i[n](t)}function ce(e,t){return(t||document).querySelector(e)}var le=e.host,ue=e.foodityUrl,pe=e.apiUrl,fe=I(),ge=null,me=!1,he=!1,ye={},ve=!1,be=null,we=[],ke=null,xe="black",Se="0.6",Ce=2147483647,Ie=6,Te={asda:"#7FC244",tesco:"#00529F",sainsburys:"#fe9900",ocado:"#434343",waitrose:"#abb414"},Ae=".constantco-widget",Ee={last_retailer:"cc_r",init_overlay:"cc_init_overlay_seen"},De=!1,Me=y(),Le=v(),_e=window.top!==window.self,Be=void 0!==window.jQuery&&window.jQuery,Re=this;this.actions=function(e){var t=null;try{t=JSON.parse(e.data)}catch(i){}if(t&&void 0!==t.action)switch(t.action){case"auth-widget":A(t);break;case"show":B(t);break;case"resize-iframe":E(t);break;case"resize-stores-iframe":Y(t.height);break;case"associated-widget-task":D(t);break;case"display":te(t);break;case"close":case"close-basket":re();break;case"sending-to-basket":De=t.sending;break;case"close-stores":ee();break;case"scroll-to-y":R(t);break;case"cco-render-assoc-widget":O(t);break;case"cco-destroy-widget":W(t);break;case"cco-set-cookie":M(t);break;case"cco-remove-cookie":L(t);break;case"cco-update-on-retailer-change":_(t);break;case"cco-render-basket":P(t);break;case"cco-track-event":N(t)}else"close"===e.data&&V()},this.addWidget=function(e){if(!w(e))return!1;var i;try{i=e.getAttribute("data-uid")}catch(n){}return i?(d("log","addWidget: Element already a widget"),!1):void t.loadState({},function(){!!T(e)})},this.setYield=function(e,t){if(!w(e))return!1;if(!x(e,"addtobasket"))return!1;if(void 0===t)return d("error","updateQty: qty not supplied"),!1;var i=parseInt(t,10);if(isNaN(i))return d("error",'updateQty: invalid qty "'+t+'" supplied'),!1;e.fdty.data=[[e.fdty.app_resource_id,i]];var n=e.firstChild;return Re.postMessage(JSON.stringify({action:"set-yield",yieldQty:i}),n.src,n.contentWindow),!0},this.setList=function(e,t){if(!w(e))return!1;var i=e.getAttribute("data-uid");if(!i)return d("log","setList: widget was not initialized"),!1;var n=e.firstChild;return!!t&&(Re.postMessage(JSON.stringify({action:"mealplanrecipes",data:t}),n.src,n.contentWindow),!0)},this.updateShoppingList=function(e,t){if(!w(e))return!1;if(!x(e,"shoppinglist"))return!1;if(void 0===t&&(t=[]),t&&"object"!=typeof t)return d("error","updateShoppingList: Recipe list not an array"),!1;if(t.length){var i=t[0];if(2!==i.length)return d("error","updateShoppingList: Recipe list item doesn't have a length of 2"),!1}var n=e.firstChild;return Re.postMessage(JSON.stringify({action:"update-shoppinglist",recipeList:t}),n.src,n.contentWindow),!0};t.loadState({},function(){i()})},u=1,p=!1,f="postMessage"in window;l.prototype.postMessage=function(e,t,i){t&&(i=i||parent,f?i.postMessage(e,t.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):t&&(i.location=t.replace(/#.*$/,"")+"#"+ +new Date+u++ +"&"+e))},l.prototype.receiveMessage=c=function(e,t,i){f?(e&&(s&&c(),s=function(i){return"string"==typeof t&&i.origin!==t?p:void e(i)}),"addEventListener"in window?window[e?"addEventListener":"removeEventListener"]("message",s,p):window[e?"attachEvent":"detachEvent"]("onmessage",s)):(a&&clearInterval(a),a=null,e&&(i="number"==typeof t?t:"number"==typeof i?i:100,a=setInterval(function(){var t=document.location.hash,i=/^#?\d+&/;t!==d&&i.test(t)&&(d=t,e({data:t.replace(i,"")}))},i)))};var g=function(e,t,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)},m=function(e,t,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i)},h=function(e){function t(e){var t={};if(t.x=0,t.y=0,null!==e){var i=document.documentElement,n=e.getBoundingClientRect(),o=i.scrollLeft||document.body.scrollLeft,r=i.scrollTop||document.body.scrollTop;t.x=n.left+o,t.y=n.top+r}return t}return t(e)},y=function(){return function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera)},v=function(){return function(e){return/android|ipad|playbook|silk/i.test(e)&&!/android.+mobile/i.test(e)}(navigator.userAgent||navigator.vendor||window.opera)},b=function(e,t,i){var n,o,r=[],a=function(e,t,i){var n,o=[];if(t===!0?t="1":t===!1&&(t="0"),null!==t){if("object"==typeof t){for(n in t)null!==t[n]&&o.push(a(e+"["+n+"]",t[n],i));return o.join(i)}if("function"!=typeof t)return w(e)+"="+w(t);throw new Error("There was an error processing for httpBuildQuery().")}return""};i||(i="&");for(o in e){n=e[o],t&&!isNaN(o)&&(o=String(t)+o);var d=a(o,n,i);""!==d&&r.push(d)}return r.join(i)},w=function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},k=function(){var e=0,t=0;return window.innerWidth&&window.innerHeight?(e=window.innerWidth,t=window.innerHeight):"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(e=document.documentElement.offsetWidth,t=document.documentElement.offsetHeight):document.body&&document.body.offsetWidth&&(e=document.body.offsetWidth,t=document.body.offsetHeight),{width:e,height:t}},x=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i===n&&(n=t.clientWidth),document.body.removeChild(t),i-n},S=function(e){return document.body.scrollHeight>k().height||e?x():0},C=function(e){return document.body.scrollWidth>document.body.clientWidth||e?x():0},I=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for(i=i<0?Math.ceil(i):Math.floor(i),i<0&&(i+=t);i<t;i++)if(i in this&&this[i]===e)return i;return-1});var T=new l;return T.receiveMessage(T.actions),n.set("addWidget",T.addWidget),n.set("setYield",T.setYield),n.set("setList",T.setList),n.set("updateShoppingList",T.updateShoppingList),$cc.module("analytics").run("stateApi"),$cc.module("analytics").run("analyticsApi"),$cc.module("experiment").run("experimentApi"),$cc.module("activity").run("activityApi"),T}).run("widgetHandler");