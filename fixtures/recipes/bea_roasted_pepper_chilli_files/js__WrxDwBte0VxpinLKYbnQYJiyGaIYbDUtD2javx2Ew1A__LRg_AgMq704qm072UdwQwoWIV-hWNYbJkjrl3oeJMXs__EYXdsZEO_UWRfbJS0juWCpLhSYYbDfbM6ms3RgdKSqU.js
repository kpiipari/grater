(function($){Drupal.GF=Drupal.GF||{};Drupal.behaviors.GoodFoodComments={attach:function(context){var comment_section=$('.section-comments__wrapper');Drupal.GF.commentsTabs(context);Drupal.GF.commentsLazyLoading(context);Drupal.GF.commentsResizeTextarea(context);Drupal.GF.commentsJChangeTabOnCheckboxChanged(comment_section);Drupal.GF.commentsJumpToCommentJustPosted(comment_section);Drupal.GF.commentsShowMore(context);Drupal.GF.commentsShowNoCommentsSignInBlock(context);}};Drupal.GF.commentsTabs=function(context){$("#tabs",context).tabs();};Drupal.GF.commentsRemoveForm=function(context){$('.comment .comment-form',context).remove();};Drupal.GF.commentsLazyLoading=function(context){var $lazy_loading=$('.section-comments__lazy-loading',context);if($lazy_loading.length){var elem_top=$lazy_loading.offset().top,lazy_loading_completed=false;$(window).on('scroll',function(){if(!lazy_loading_completed){var $window=$(this),doc_view_bottom=$window.scrollTop()+$window.height();if(doc_view_bottom>=elem_top){lazy_loading_completed=true;$lazy_loading.find('a').click();}}}).scroll();}};Drupal.GF.commentsResizeTextarea=function(context){$('.comment-form__textarea-wrapper',context).find('textarea').focus(function(){$(this).addClass('form-textarea--expanded');}).focusout(function(){if(!$(this).val()){$(this).removeClass('form-textarea--expanded');}});};Drupal.GF.commentsJChangeTabOnCheckboxChanged=function(context){var tab;$('.comment-form__wrapper',context).find("input[name='field_bbcgf_classification[und]']").change(function(){switch($(this).val()){case'189':tab=1;break;case'190':tab=2;break;default:tab=0;}
$('.section-comments__single-tab-link',context).eq(tab).click();});};Drupal.GF.commentsJumpToCommentJustPosted=function(context){if($('.section-comments__tabs',context).find('.comment__just-posted').length){$('body').scrollTo('.section-comments__tabs',500);}};Drupal.GF.commentsShowMore=function(context){var text,$tab=$('.section-comments__single-tab-content',context);$tab.each(function(index){var $current_tab=$(this),$view_more_wrapper=$('<div></div>').addClass('comment__show-more-wrapper'),$rows=$current_tab.find('.view-content > div');if(!$current_tab.hasClass('section-comments__show-more-executed-once')&&$rows.length>2){$current_tab.addClass('section-comments__show-more-executed-once').addClass('section-comments__mask');switch(index){case 1:text='View more questions';break;case 2:text='View more tips';break;default:text='View more comments';}
$view_more_wrapper.append($('<div></div>').addClass('comment__show-more-button btn--primary').text(text));$current_tab.append($view_more_wrapper).find('.comment__show-more-button').click(function(){$current_tab.removeClass('section-comments__mask').find($view_more_wrapper).remove();});}});};Drupal.GF.commentsShowNoCommentsSignInBlock=function(context){if($('.section-comments__join_discussion',context).length){$('.comment__no-comments-sign-in',context).show();}};$.fn.commentsPostNewCommentFunction=function(comment_type){var tab;switch(comment_type){case'question':tab=1;break;case'tip':tab=2;break;case'comment':default:tab=0;}
var $link=$('.section-comments__single-tab-link').eq(tab),$link_text=$link.text(),pos_1=$link_text.indexOf("(")+1,pos_2=$link_text.indexOf(")"),$count=$link_text.substring(pos_1,pos_2);$link.text($link_text.substring(0,pos_1)+(parseInt($count)+1)+$link_text.substring(pos_2));$link.click();};})(jQuery);;(function($){Drupal.flagLink=function(context){function updateLink(element,newHtml){var $newLink=$(newHtml);$('.flag-message',$newLink).css('display','none');var $nucleus=$newLink.is('a')?$newLink:$('a.flag',$newLink);$nucleus.addClass('flag-processed').click(flagClick);var $wrapper=$(element).parents('.flag-wrapper:first');$wrapper.after($newLink).remove();Drupal.attachBehaviors($newLink.get(0));$('.flag-message',$newLink).fadeIn();setTimeout(function(){$('.flag-message.flag-auto-remove',$newLink).fadeOut()},3000);return $newLink.get(0);}
function flagClick(event){event.preventDefault();var element=this;var $wrapper=$(element).parents('.flag-wrapper');if($wrapper.is('.flag-waiting')){return false;}
$wrapper.addClass('flag-waiting');$('span.flag-message:visible').fadeOut();$.ajax({type:'POST',url:element.href,data:{js:true},dataType:'json',success:function(data){data.link=$wrapper.get(0);$.event.trigger('flagGlobalBeforeLinkUpdate',[data]);if(!data.preventDefault){data.link=updateLink(element,data.newLink);}
var $wrappers=$('.flag-wrapper.flag-'+data.flagName.flagNameToCSS()+'-'+data.contentId).not(data.link);var $newLink=$(data.newLink);$('.flag-message',$newLink).hide();$wrappers=$newLink.replaceAll($wrappers);Drupal.attachBehaviors($wrappers.parent());$.event.trigger('flagGlobalAfterLinkUpdate',[data]);},error:function(xmlhttp){alert('An HTTP error '+xmlhttp.status+' occurred.\n'+element.href);$wrapper.removeClass('flag-waiting');}});}
$('a.flag-link-toggle:not(.flag-processed)',context).addClass('flag-processed').click(flagClick);};Drupal.flagAnonymousLinks=function(context){$('a.flag:not(.flag-anonymous-processed)',context).each(function(){this.href+=(this.href.match(/\?/)?'&':'?')+'has_js=1';$(this).addClass('flag-anonymous-processed');});}
String.prototype.flagNameToCSS=function(){return this.replace(/_/g,'-');}
Drupal.flagAnonymousLinkTemplates=function(context){var templates=Drupal.settings.flag.templates;var userFlags=Drupal.flagCookie('flags');if(userFlags){userFlags=userFlags.split('+');for(var n in userFlags){var flagInfo=userFlags[n].match(/(\w+)_(\d+)/);var flagName=flagInfo[1];var contentId=flagInfo[2];if(templates[flagName+'_'+contentId]){$('.flag-'+flagName.flagNameToCSS()+'-'+contentId,context).after(templates[flagName+'_'+contentId]).remove();}}}
var globalFlags=document.cookie.match(/flag_global_(\w+)_(\d+)=([01])/g);if(globalFlags){for(var n in globalFlags){var flagInfo=globalFlags[n].match(/flag_global_(\w+)_(\d+)=([01])/);var flagName=flagInfo[1];var contentId=flagInfo[2];var flagState=(flagInfo[3]=='1')?'flag':'unflag';if(templates[flagName+'_'+contentId]){$('.flag-'+flagName.flagNameToCSS()+'-'+contentId,context).each(function(){if($(this).find('.'+flagState+'-action').size()){$(this).after(templates[flagName+'_'+contentId]).remove();}});}}}}
Drupal.flagCookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options=$.extend({},options);options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};Drupal.behaviors.flagLink={};Drupal.behaviors.flagLink.attach=function(context){if(Drupal.settings.flag&&Drupal.settings.flag.templates){Drupal.flagAnonymousLinkTemplates(context);}
if(Drupal.settings.flag&&Drupal.settings.flag.anonymous){Drupal.flagAnonymousLinks(context);}
Drupal.flagLink(context);};})(jQuery);;(function($){Drupal.Views={};Drupal.behaviors.viewsTabs={attach:function(context){if($.viewsUi&&$.viewsUi.tabs){$('#views-tabset').once('views-processed').viewsTabs({selectedClass:'active'});}
$('a.views-remove-link').once('views-processed').click(function(event){var id=$(this).attr('id').replace('views-remove-link-','');$('#views-row-'+id).hide();$('#views-removed-'+id).attr('checked',true);event.preventDefault();});$('a.display-remove-link').addClass('display-processed').click(function(){var id=$(this).attr('id').replace('display-remove-link-','');$('#display-row-'+id).hide();$('#display-removed-'+id).attr('checked',true);return false;});}};Drupal.Views.parseQueryString=function(query){var args={};var pos=query.indexOf('?');if(pos!=-1){query=query.substring(pos+1);}
var pairs=query.split('&');for(var i in pairs){if(typeof(pairs[i])=='string'){var pair=pairs[i].split('=');if(pair[0]!='q'&&pair[1]){args[decodeURIComponent(pair[0].replace(/\+/g,' '))]=decodeURIComponent(pair[1].replace(/\+/g,' '));}}}
return args;};Drupal.Views.parseViewArgs=function(href,viewPath){var returnObj={};var path=Drupal.Views.getPath(href);if(viewPath&&path.substring(0,viewPath.length+1)==viewPath+'/'){var args=decodeURIComponent(path.substring(viewPath.length+1,path.length));returnObj.view_args=args;returnObj.view_path=path;}
return returnObj;};Drupal.Views.pathPortion=function(href){var protocol=window.location.protocol;if(href.substring(0,protocol.length)==protocol){href=href.substring(href.indexOf('/',protocol.length+2));}
return href;};Drupal.Views.getPath=function(href){href=Drupal.Views.pathPortion(href);href=href.substring(Drupal.settings.basePath.length,href.length);if(href.substring(0,3)=='?q='){href=href.substring(3,href.length);}
var chars=['#','?','&'];for(i in chars){if(href.indexOf(chars[i])>-1){href=href.substr(0,href.indexOf(chars[i]));}}
return href;};})(jQuery);;(function($){Drupal.ajax.prototype.commands.viewsLoadMoreAppend=function(ajax,response,status){var wrapper=response.selector?$(response.selector):$(ajax.wrapper);var method=response.method||ajax.method;var targetList=response.targetList||'';var effect=ajax.getEffect(response);var pager_selector=response.options.pager_selector?response.options.pager_selector:'.pager-load-more';var new_content_wrapped=$('<div></div>').html(response.data);var new_content=new_content_wrapped.contents();if(new_content.length!=1||new_content.get(0).nodeType!=1){new_content=new_content_wrapped;}
var settings=response.settings||ajax.settings||Drupal.settings;Drupal.detachBehaviors(wrapper,settings);if($.waypoints!=undefined){$.waypoints('refresh');}
var content_query=targetList&&!response.options.content?'> .view-content '+targetList:response.options.content||'> .view-content';if(effect.showEffect!='show'){new_content.find(content_query).children().hide();}
wrapper.find(pager_selector).replaceWith(new_content.find(pager_selector));wrapper.find(content_query)[method](new_content.find(content_query).children());wrapper.find(content_query).children().removeClass('views-row-first views-row-last views-row-odd views-row-even').filter(':first').addClass('views-row-first').end().filter(':last').addClass('views-row-last').end().filter(':even').addClass('views-row-odd').end().filter(':odd').addClass('views-row-even').end();if(effect.showEffect!='show'){wrapper.find(content_query).children(':not(:visible)')[effect.showEffect](effect.showSpeed);}
wrapper.trigger('views_load_more.new_content',new_content.clone());var classes=wrapper.attr('class');var onceClass=classes.match(/jquery-once-[0-9]*-[a-z]*/);wrapper.removeClass(onceClass[0]);settings=response.settings||ajax.settings||Drupal.settings;Drupal.attachBehaviors(wrapper,settings);};Drupal.behaviors.ViewsLoadMore={attach:function(context,settings){var default_opts={offset:'100%'};if(settings&&settings.viewsLoadMore&&settings.views&&settings.views.ajaxViews){$.each(settings.viewsLoadMore,function(i,setting){var view='.view-id-'+setting.view_name+'.view-display-id-'+setting.view_display_id+' .pager-next a',opts={};$.extend(opts,default_opts,settings.viewsLoadMore[i].opts);$(view).waypoint('destroy');$(view).waypoint(function(event,direction){$(view).click();},opts);});}},detach:function(context,settings,trigger){if(settings&&settings.viewsLoadMore&&settings.views&&settings.views.ajaxViews){$.each(settings.viewsLoadMore,function(i,setting){var view='.view-id-'+setting.view_name+'.view-display-id-'+setting.view_display_id;if($(context).is(view)){$('.pager-next a',view).waypoint('destroy');}
else{$(view,context).waypoint('destroy');}});}}};})(jQuery);;(function($){Drupal.behaviors.ViewsAjaxView={};Drupal.behaviors.ViewsAjaxView.attach=function(){if(Drupal.settings&&Drupal.settings.views&&Drupal.settings.views.ajaxViews){$.each(Drupal.settings.views.ajaxViews,function(i,settings){Drupal.views.instances[i]=new Drupal.views.ajaxView(settings);});}};Drupal.views={};Drupal.views.instances={};Drupal.views.ajaxView=function(settings){var selector='.view-dom-id-'+settings.view_dom_id;this.$view=$(selector);var ajax_path=Drupal.settings.views.ajax_path;if(ajax_path.constructor.toString().indexOf("Array")!=-1){ajax_path=ajax_path[0];}
var queryString=window.location.search||'';if(queryString!==''){var queryString=queryString.slice(1).replace(/q=[^&]+&?|&?render=[^&]+/,'');if(queryString!==''){queryString=((/\?/.test(ajax_path))?'&':'?')+queryString;}}
this.element_settings={url:ajax_path+queryString,submit:settings,setClick:true,event:'click',selector:selector,progress:{type:'throbber'}};this.settings=settings;this.$exposed_form=$('#views-exposed-form-'+settings.view_name.replace(/_/g,'-')+'-'+settings.view_display_id.replace(/_/g,'-'));this.$exposed_form.once(jQuery.proxy(this.attachExposedFormAjax,this));this.$view.filter(jQuery.proxy(this.filterNestedViews,this)).once(jQuery.proxy(this.attachPagerAjax,this));var self_settings=this.element_settings;self_settings.event='RefreshView';this.refreshViewAjax=new Drupal.ajax(this.selector,this.$view,self_settings);};Drupal.views.ajaxView.prototype.attachExposedFormAjax=function(){var button=$('input[type=submit], button[type=submit], input[type=image]',this.$exposed_form);button=button[0];this.exposedFormAjax=new Drupal.ajax($(button).attr('id'),button,this.element_settings);};Drupal.views.ajaxView.prototype.filterNestedViews=function(){return!this.$view.parents('.view').size();};Drupal.views.ajaxView.prototype.attachPagerAjax=function(){this.$view.find('ul.pager > li > a, th.views-field a, .attachment .views-summary a').each(jQuery.proxy(this.attachPagerLinkAjax,this));};Drupal.views.ajaxView.prototype.attachPagerLinkAjax=function(id,link){var $link=$(link);var viewData={};var href=$link.attr('href');$.extend(viewData,this.settings,Drupal.Views.parseQueryString(href),Drupal.Views.parseViewArgs(href,this.settings.view_base_path));$.extend(viewData,Drupal.Views.parseViewArgs(href,this.settings.view_base_path));this.element_settings.submit=viewData;this.pagerAjax=new Drupal.ajax(false,$link,this.element_settings);};Drupal.ajax.prototype.commands.viewsScrollTop=function(ajax,response,status){var offset=$(response.selector).offset();var scrollTarget=response.selector;while($(scrollTarget).scrollTop()==0&&$(scrollTarget).parent()){scrollTarget=$(scrollTarget).parent();}
if(offset.top-10<$(scrollTarget).scrollTop()){$(scrollTarget).animate({scrollTop:(offset.top-10)},500);}};})(jQuery);;(function($){Drupal.ajax.prototype.originalBeforeSerialize=Drupal.ajax.prototype.beforeSerialize;Drupal.ajax.prototype.beforeSerialize=function(element,options){if(this.form){var settings=this.settings||Drupal.settings;Drupal.detachBehaviors(this.form,settings,'serialize');}
if(options.url&&options.url.indexOf('/views/ajax')!==-1&&Drupal.settings.viewsAjaxGet&&$.inArray(options.data.view_name,Drupal.settings.viewsAjaxGet)!==-1){options.type='GET';return;}
return this.originalBeforeSerialize(element,options);};})(jQuery);;(function($){Drupal.GFPrint=Drupal.GFPrint||{};Drupal.behaviors.GoodFoodPrintPdf={attach:function(context){$('.recipe-header__print .btn--print',context).on('click',function(e){e.preventDefault();if(typeof Drupal.GFAnalytics!=='undefined'){Drupal.GFAnalytics.trackEvent(['Internal Link','click','Recipe Print']);}
Drupal.GFPrint.printPage(Drupal.settings.bbcgf_pdf.url);});}};Drupal.GFPrint.printPage=function(url){var iframe=document.createElement("iframe");iframe.onload=Drupal.GFPrint.setPrint;iframe.style.visibility="hidden";iframe.style.position="fixed";iframe.style.right="0";iframe.style.bottom="0";iframe.src=url;document.body.appendChild(iframe);};Drupal.GFPrint.closePrint=function(){document.body.removeChild(this.__container__);};Drupal.GFPrint.setPrint=function(){this.contentWindow.__container__=this;this.contentWindow.onbeforeunload=Drupal.GFPrint.closePrint;this.contentWindow.onafterprint=Drupal.GFPrint.closePrint;this.contentWindow.focus();this.contentWindow.print();};})(jQuery);;