"use strict";angular.module("constantco",[]),angular.module("constantco").directive("constantcoWatchElementHeightChange",["$window","$timeout","constantcoFrameCommService","constantcoAppConfig",function(a,b,c,d){return{scope:!0,link:function(a,b,d){a.getElementDimensions=function(){return b[0].offsetHeight},a.$watch(a.getElementDimensions,function(a,d){a&&c.sendMessage({action:"resize-iframe",height:b[0].offsetHeight,noAnimation:!0})})}}}]),angular.module("constantco").directive("constantcoWatchWindowResize",["$window","$timeout","constantcoAppConfig",function(a,b,c){return{scope:!0,link:function(d,e,f){var g=angular.element(a);d.getWindowDimensions=function(){return{height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},d.$watch(d.getWindowDimensions,function(a){a&&(c.opts.dimensions=a)},!0),g.bind("resize",function(){b(function(){d.$apply()},0)})}}}]),angular.module("constantco").directive("constantcoCloseOnEsc",["$window","constantcoAppConfig","constantcoFrameCommService",function(a,b,c){return{scope:!0,link:function(a,d,e){d.bind("keyup",function(a){var d=window.event?a.keyCode:a.which;27===d&&c.sendMessage({action:"cco-destroy-widget",targetWidget:b.opts.appType})})}}}]),angular.module("constantco").directive("constantcoCloseOnOuterClick",["$window","constantcoAppConfig","constantcoFrameCommService",function(a,b,c){return{scope:!0,link:function(a,d,e){a.$watch(function(){return b.lastRawMessage},function(a){a.msg&&"backdrop-outer-click"==a.msg.action&&c.sendMessage({action:"cco-destroy-widget",targetWidget:b.opts.appType})},!0)}}}]),angular.module("constantco").directive("constantcoWatchLayoutClass",["$window","constantcoAppConfig",function(a,b){return{scope:!0,link:function(a,c,d){a.$watch(function(){return b.opts.isDesktopView},function(a){angular.element(document.body).toggleClass("view-desktop",a)})}}}]),angular.module("constantco").factory("constantcoAppConfig",function(){return{origin:"*",opts:{initSettingsContainerId:"app-data",initSettings:{},appId:"",appType:"",btnUid:"",userHash:"",customData:"",trackingContext:"",appResourceId:"",initialRetailer:null,lastRetailer:null,isDesktopView:!1},lastRawMessage:{msg:""},dimensions:{width:0,height:0}}}),angular.module("constantco").service("constantcoAppHelperService",["constantcoAppConfig",function(a){this.genAppUrl=function(b){var c=a.opts.initSettings["app-url"]||"",d=c+"/"+b+".html";return d},this.genAppTemplatesUrl=function(){var a="",b="templates/";return a+b},this.getElementPosition=function(a){var b={};if(b.x=0,b.y=0,null!==a){var c=document.documentElement,d=a.getBoundingClientRect(),e=c.scrollLeft||document.body.scrollLeft,f=c.scrollTop||document.body.scrollTop;b.x=d.left+e,b.y=d.top+f}return b},this.generateHash=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}]),angular.module("constantco").directive("constantcoScrollToElement",["$window","constantcoFrameCommService",function(a,b){return{restrict:"A",scope:{targetId:"@constantcoScrollToElement"},link:function(a,c,d){c.on("click",function(c){var d=document.getElementById(a.targetId);if(d){var e=d.getBoundingClientRect();b.sendMessage({action:"scroll-to-y",y:e.top})}c.preventDefault(),c.stopPropagation()})}}}]),angular.module("constantco").directive("constantcoFetchInitSettings",["$log","constantcoAppConfig",function($log,constantcoAppConfig){return{controller:["$scope","$element","$attrs",function($scope,$element,$attrs){var stx=document.getElementById(constantcoAppConfig.opts.initSettingsContainerId);try{stx&&(constantcoAppConfig.opts.initSettings=angular.fromJson(eval("("+stx.innerHTML+")")))}catch(e){}}]}}]),angular.module("constantco").directive("constantcoPostMessage",["$window","$timeout","constantcoFrameCommService","constantcoAppConfig",function(a,b,c,d){return{restrict:"A",controller:["$element","$attrs",function(b,e){var f=c.processInitParams(a.location.search);f&&(c.sendMessage({action:"auth-widget",width:document.body.offsetWidth,height:document.body.offsetHeight}),d.opts.initSettings["app-init-event-name"]&&c.sendMessage({action:d.opts.initSettings["app-init-event-name"],widgetName:d.opts.appType}))}],link:function(d,e,f){angular.element(a).bind("message",function(a){c.receiveMessage(a),b(function(){d.$apply()},0)})}}}]),angular.module("constantco").service("constantcoFrameCommService",["$log","constantcoAppConfig",function(a,b){this.processInitParams=function(a){for(var c={},d=location.search.substring(1).split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]){try{f[1]=decodeURIComponent(f[1])}catch(g){continue}c[f[0]]=f[1]||!0}}return b.opts.rawParams=c,b.opts.btnUid=c.btn_uid||"",b.opts.appId=c.app_id||c.app_id_assoc,b.opts.appResourceId=c.app_resource_id||"",b.opts.appType=c.app_type||"",b.opts.customData=c.custom_data||"",b.opts.trackingContext=c.tracking_context||"",b.opts.isDesktopView=parseInt(c.window_width,10)<parseInt(c.mobile_breakpoint,10)?!1:!0,b.opts.initialRetailer=c.cc_r||"",b.opts.userHash=c.session||"",b.opts.userHashCandidate=c.tmp_hash||"","undefined"==typeof c.app_id_assoc},this.sendMessage=function(a){var c={app_id:b.opts.appId,btn_uid:b.opts.btnUid};c=angular.extend(c,a),a.action&&parent.postMessage(JSON.stringify(c),b.origin)},this.receiveMessage=function(c){if(c&&c.data){var d=!1;if(angular.forEach(b.opts.initSettings.origin,function(a){c.origin==a&&(d=!0)}),d)switch(b.lastRawMessage.msg=angular.fromJson(c.data),b.lastRawMessage.msg.action){case"switchview":b.opts.isDesktopView=b.lastRawMessage.msg.data.isDesktopView;break;case"selectretailer":b.opts.lastRetailer=b.lastRawMessage.msg.data.id}else a.debug("origin does not match");return!0}return!1}}]),angular.module("analytics",["constantco"]),angular.module("analytics").service("analyticsService",["$http","$filter","$q","constantcoAppConfig","userService","retailerService","predictRetailerExperimentService",function(a,b,c,d,e,f,g){function h(a){a=angular.copy(a),a.eventContext="other",a.type="cloudlist-action","project_id"in a&&(a.projectId=a.project_id,delete a.project_id),"event_type_id"in a&&delete a.event_type_id,"category"in a&&(a.trackedItem=a.category,delete a.category),"action"in a&&(a.trackedAction=a.action,delete a.action),"label"in a&&(a.trackedLabel=a.label,delete a.label),"value"in a&&(a.trackedValue=a.value,delete a.value),"cc_hash"in a&&(a.legacyCookieHash=a.cc_hash,delete a.cc_hash);var b=f.getSelectedRetailer();a.storeId=b?b.internalId:0;var c=f.getActivePredictedRetailer();return c&&c===b&&(a.storeId=0),a}function i(a,c,e,f){var g={action:a,"event-data":e?b("allowedEventData")(c,e):c};f&&(g.url=f),parent.postMessage(JSON.stringify(g),d.origin)}var j=+(new Date).getTime(),k=[],l=this,m=function(){return this.context},n=function(a){this.context=a},o=function(a){this.defaultEventTypeId=a},p=function(a){this.trackingUrl=a},q=function(a,b){this.clientEventId=a,this.clientEventFilter=b},r=function(a){this.projectId=a},s=function(a){if(a.category=this.context||d.opts.trackingContext,a.project_id=this.projectId,a.cc_hash=e.getUserHash(),a.event_type_id=a.event_type_id||this.defaultEventTypeId,"string"==typeof a.value&&"seconds"===a.value){var b=+(new Date).getTime();a.value=Math.floor((b-j)/1e3)}i("cco-track-event",a,!1,d.opts.initSettings["api-url"]+this.trackingUrl),e.getShopperState().then(function(b){g.getActiveExperiment().then(function(c){var e={action:"cc-analytics-track-event",data:{projectId:l.projectId||51,appContext:"bbc",sourceId:"bbcgf",sourceVersion:"1",dataVersion:"1",event:h(a)}};if(e.data.event.shopperState=b,"view"===e.data.event.trackedAction&&("recipe-shopping-tools"===e.data.event.trackedItem||"shopping-list"===e.data.event.trackedItem)){c&&(e.data.experiment={id:c.name,variation:c.chosen?"exp":"ctrl"});var g=f.getMatchingV2SingleImplicitRetailer();if(g)e.data.event.trackedValue="implicit";else{var i=f.getActivePredictedRetailer();i&&(e.data.event.trackedValue=i.internalId)}}parent.postMessage(JSON.stringify(e),d.origin)})})},t=function(a,b){(void 0===b.trackEventCondition||"true"===b.trackEventCondition)&&this.track(a)},u=function(a){k.push(a)},v=function(){angular.forEach(k,function(a){a()}),k=[]};return{getContext:m,setContext:n,setDefaultEventTypeId:o,setProjectId:r,setTrackingUrl:p,setPostClientEvent:q,track:s,trackElementEvent:t,addToEventQueue:u,triggerEventQueue:v}}]),angular.module("analytics").directive("trackEvent",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){if(d.trackEventWhen)b.$watch(function(){return b.$eval(d.trackEventWhen)},function(c){c&&a.trackElementEvent(b.$eval(d.trackEvent),d)});else if(d.trackEventOnceWhen)var e=b.$watch(function(){return b.$eval(d.trackEventOnceWhen)},function(c){c&&(a.trackElementEvent(b.$eval(d.trackEvent),d),e&&e())})}}}]),angular.module("analytics").directive("trackEventInit",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){a.trackElementEvent(b.$eval(d.trackEventInit),d)}}}]),angular.module("analytics").directive("trackEventClick",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){angular.element(c).on("click",function(c){a.trackElementEvent(b.$eval(d.trackEventClick),d)})}}}]),angular.module("analytics").directive("trackEventSubmit",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){angular.element(c).on("submit",function(){a.trackElementEvent(b.$eval(d.trackEventSubmit),d)})}}}]),angular.module("analytics").directive("trackEventGlobalEsc",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){angular.element(document).on("keyup",function(c){27===c.which&&a.trackElementEvent(b.$eval(d.trackEventGlobalEsc),d)})}}}]),angular.module("analytics").directive("trackEventOuterClick",["constantcoAppConfig","analyticsService",function(a,b){return{restrict:"A",link:function(c,d,e){c.$watch(function(){return a.lastRawMessage},function(a){a.msg&&"backdrop-outer-click"==a.msg.action&&b.trackElementEvent(c.$eval(e.trackEventOuterClick),e)},!0)}}}]),angular.module("analytics").directive("trackEventQueue",["analyticsService",function(a){return{restrict:"A",link:function(b,c,d){a.addToEventQueue(function(){a.trackElementEvent(b.$eval(d.trackEventQueue),d)})}}}]),angular.module("analytics").filter("allowedEventData",function(){return function(a,b){var c={};for(var d in a)d in b&&(c[b[d]]=a[d]);return c}}),angular.module("comm",[]).service("commService",["$window",function(a){function b(a,b,c){f[a]=f[a]||[],f[a].push({source:c||null,callback:b})}function c(a,b,c,d){var c={action:b,data:c};if(d){var f=e();g[f]=d,c.callbackId=f}a.postMessage(JSON.stringify(c),"*")}function d(a){if("string"==typeof a.data){try{var b=JSON.parse(a.data)}catch(c){return}var d=b.action,e=b.callbackId,h=b.callback;if(h&&h in g)g[h](b.response),delete g[h];else if(d&&d in f)for(var i=0;i<f[d].length;i++){var j=f[d][i].source,h=f[d][i].callback;(null===j||j===a.source)&&h(b.data,function(b){var c={callback:e,response:b};a.source.postMessage(JSON.stringify(c),a.origin)})}}}function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+(new Date).getTime()}var f={},g={};return a.addEventListener("message",d,!1),{registerListener:b,sendMessage:c}}]),angular.module("gfSharedApp",["templatesCache","ipCookie","analytics","comm"]),angular.module("gfSharedApp").run(["projectConstants","analyticsService",function(a,b){b.setTrackingUrl(a.ANALYTICS_TRACKING_URL),b.setProjectId(a.ANALYTICS_PROJECT_ID),b.setDefaultEventTypeId(a.ANALYTICS_DEFAULT_EVENT_TYPE_ID),a.ANALYTICS_CLIENT_EVENT_ID&&b.setPostClientEvent(a.ANALYTICS_CLIENT_EVENT_ID,a.ANALYTICS_CLIENT_EVENT_FILTER)}]),angular.module("gfSharedApp").filter("separatedList",function(){return function(a,b){return b=b||",",a?a.join(b):""}}),angular.module("gfSharedApp").filter("openRecipeIds",function(){return function(a){if(a&&a[0]&&"object"!=typeof a[0])return a;var b=[];return angular.forEach(a,function(a){a.isDeleted||b.push(a.id)}),b}}),angular.module("gfSharedApp").filter("mealPlanRecipesPriceExternal",function(){return function(a){var b={};return angular.forEach(a,function(a){a.serves>0?b[a.originalId]="&pound;"+(a.priceUsedPart/a.serves).toFixed(2)+" per serving":b[a.originalId]="&pound;"+a.priceUsedPart.toFixed(2)+" in total"}),b}}),angular.module("templatesCache",[]).run(["$templateCache",function(a){a.put("views/init-overlay-content/main.html","<div class=\"modal select-ret-overlay init-overlay\" track-event-init=\"{ action: 'view' }\" track-event-global-esc=\"{ action: 'dismiss', label: 'esc', value: 'seconds' }\" track-event-outer-click=\"{ action: 'dismiss', label: 'outside', value: 'seconds' }\">\n    <div class=\"modal-inner\">\n"+'        <img class="ribbon-img" src="https://di0rl3y8b5d1b.cloudfront.net/images/7581ee8d.temp_image3.png" alt="ribbon">\n        <div class="modal-inner-layout">\n            <h3><img src="https://di0rl3y8b5d1b.cloudfront.net/images/38d6651a.logo-sm.jpg" alt="goodFood logo"> </h3>\n            <p>Select a supermarket to see <span>prices<img class="arrow-img" src="https://di0rl3y8b5d1b.cloudfront.net/images/bbea304e.temp_image2.png" alt="arrow image"></span> &amp; shop for recipes!</p>\n            <img class="ingredient-img" src="https://di0rl3y8b5d1b.cloudfront.net/images/93eeb8a9.temp_image.jpg" alt="ingredient image">\n\n            <div class="price recipe-tool yes-smarket">\n                <span class="total-amount">£3.80</span><span> per serving</span>\n                <br>\n                \n            </div>\n\n            <div super-market-buttons-component close="close" initial-overlay-only="true"></div>\n\n        </div>\n    </div>\n</div>'),a.put("views/init-overlay/main.html",""),a.put("views/mealplan-tools/main.html",'<div class="recipe-tool meal-plan container" ng-class="vm.selectedStore" choose-retailer-overlay-manager track-event="{ action: \'view\', label: (vm.selectedStore.id || \'unbranded\') }" track-event-once-when="!vm.loadRecipes.loading">\n    <div class="recipe-tool--header">\n        <h3>Shopping tools</h3>\n        <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" class="learn-more u-link" target="_top">How this works</a>\n        <a href="http://www.bbcgoodfood.com/shopping-list/my-shopping-list" target="_top" class="u-link shopping-list-link">View shopping list</a>\n    </div>\n    <div class="inner-container">\n        <div ng-show="vm.loadRecipes.loading">\n            Loading...\n        </div>\n        <div ng-show="vm.loadRecipes.loadingFailed">\n            Sorry the shopping tools aren\'t available for this meal plan. <a role="button" href="" ng-click="getMealplanRecipes()">Try again</a>\n        </div>\n        <div ng-show="vm.loadRecipes.loaded">\n            <div ng-show="!vm.selectedStore" class="choose-market-section no-smarket">\n                <h4 class="show-mobile">Shop for this recipe</h4>\n                <h4 class="show-desktop">Choose a supermarket to see prices</h4>\n                <div>\n                    <div class="show-desktop price"><span class="curr-icon">£</span> 00.00</div>\n                    <div choose-retailer-dropdown-manager based-on="mealplantools"></div>\n                    <div class="show-mobile-inline price"><span class="curr-icon">£</span> 00.00</div>\n                </div>\n            </div>\n            <div ng-show="vm.selectedStore" class="choose-market-section yes-smarket">\n                <h4>Shop for selected recipes</h4>\n                <div ng-show="vm.priceLoaded && !vm.priceLoading">\n                    <span class="total-amount">{{ vm.totalAmount| currency : \'£\' }}</span>estimated cost\n                    <div ng-show="vm.calculationEstimated" class="total-amount-warning" tooltip-timer="5000">\n                        <i class="icon icon-info-warning"><span class="sr-only">warning</span></i>\n                        <span class="tooltip tooltip--top" ng-class="{\'no-serves\': !vm.hasServes}">\n                            <div class="tooltip__inner">\n                                <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" target="_top">How this works</a>\n                                Average prices have been used for ingredients that are not available at your supermarket.\n                            </div>\n                        </span>\n                    </div>\n                    <div ng-show="!vm.calculationEstimated && !vm.calculationComplete" class="total-amount-warning" tooltip-timer="5000">\n                        <i class="icon icon-info-warning"><span class="sr-only">warning</span></i>\n                        <span class="tooltip tooltip--top" ng-class="{\'no-serves\': !vm.hasServes}">\n                            <div class="tooltip__inner">\n                                <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" target="_top">How this works</a>\n                                Please note prices for some ingredients are not available at your chosen supermarket\n                            </div>\n                        </span>\n                    </div>\n                </div>\n                <div ng-show="vm.priceLoading" class="price-loading">\n                    <span>Calculating price...</span>\n                </div>\n                <div ng-show="vm.priceLoadingFailed && !vm.priceLoading" class="price-loading-failed">\n                    <span>Sorry price currently unavailable. <a href="" ng-click="getRecipesPrice(vm.mealplanRecipeIds, vm.allMealPlanRecipeIds)">Try again</a></span>\n                </div>\n                <span>You<span class="layout-lg-inline">r</span>&nbsp;selected<span class="layout-lg-inline"> supermarket</span>:</span>\n                <span class="{{vm.selectedStore.id}} sprite retailer-{{vm.selectedStore.id}}">{{ vm.selectedStore.alt}}</span>\n                <a ng-click="chooseStoreOverlayOpen()" class="change-smarket-link u-link" href="" ng-show="vm.selectedStore">Change</a>\n            </div>\n\n            <div class="shop-meal-section">\n                <div id="mealPlanDropDown" class="shop-meal-inner" ng-class="{show: vm.showMealPlan}">\n                    <h4>Add ingredients to:</h4>\n                    <div>\n                        <span my-shopping-list-button-manager selected-store="vm.selectedStore" recipes="vm.mealplanRecipeIds" based-on="mealplantools" meal-plan-internal-id="vm.mealplanId"></span>\n                        <span class="btn-text-aside">to plan<span class="layout-lg-inline"> your shop</span></span>\n                    </div>\n                    <div>\n                        <span choose-retailer-button-manager selected-store="vm.selectedStore" recipes="vm.mealplanRecipeIds" basket-overlay-open-fn="basketOverlayOpen()" choose-store-overlay-open-fn="chooseStoreOverlayOpenAndRedirect()" choose-store-overlay-open-no-redirect-fn="chooseStoreOverlayOpen()"></span>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n    <div class="recipe-tool--footer">\n        <a href="http://www.bbcgoodfood.com/shopping-list/my-shopping-list" target="_top" class="u-link shopping-list-link">View shopping list</a>\n    </div>\n</div>'),a.put("views/print-overlay-content/main.html",'<div>\n    <div class="wrapper">\n        <header>\n            <img src="https://di0rl3y8b5d1b.cloudfront.net/images/fdf4d788.logo-lg.jpg" class="logo">\n\n            <div class="user">\n                username\n                <time datetime="2014-08-14">14/08/14</time>\n            </div>\n        </header>\n\n        <h1>Shopping list - 14 Aug</h1>\n\n        <main>\n            <div class="ingredients-group">\n                <h2>Meat &amp; fish</h2>\n                <ul>\n                    <li>500g chicken thighs</li>\n                    <li>500g lean minced beef</li>\n                    <li>350g cooked &amp; peeled prawns</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Fruit &amp; vegetables</h2>\n                <ul>\n                    <li>3 onions</li>\n                    <li>100g baby spinach</li>\n                    <li>2 courgettes</li>\n                    <li>4 cellery sticks</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Store cupboard</h2>\n                <ul>\n                    <li>30 all-purpose white flour</li>\n                    <li>300g white rice</li>\n                    <li>30ml balsamic vinegar</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Pantry</h2>\n                <ul>\n                    <li>ground cumin</li>\n                    <li>chilli powder</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Store cupboard</h2>\n                <ul>\n                    <li>30 all-purpose white flour</li>\n                    <li>300g white rice</li>\n                    <li>30ml balsamic vinegar</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Store cupboard</h2>\n                <ul>\n                    <li>30 all-purpose white flour</li>\n                    <li>300g white rice</li>\n                    <li>30ml balsamic vinegar</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Store cupboard</h2>\n                <ul>\n                    <li>30 all-purpose white flour</li>\n                    <li>300g white rice</li>\n                    <li>30ml balsamic vinegar</li>\n                </ul>\n            </div>\n\n            <div class="ingredients-group">\n                <h2>Store cupboard</h2>\n                <ul>\n                    <li>30 all-purpose white flour</li>\n                    <li>300g white rice</li>\n                    <li>30ml balsamic vinegar</li>\n                </ul>\n            </div>\n        </main>\n\n        <footer></footer>\n    </div>\n</div>'),a.put("views/print-overlay/main.html",'<div class="modal print-overlay">\n    <div class="modal-inner">\n        <div class="modal-inner-layout">\n            <a href="" class="modal-close pull-right" ng-click="close()">Close <i class="icon icon-cross"></i></a>\n            <h3 class="border">Print preview</h3>\n\n            <div dynamic-overlay-frame-wrapper>\n                <iframe id="print-preview" name="print-preview" src="print-overlay-content.html" allowtransparency="true"></iframe>\n            </div>\n\n            <button class="btn btn-bbcgf btn-purple print" print="print-preview" shopping-list-print-manager callback-fn="close">Print <i class="icon icon-print"></i></button>\n        </div>\n    </div>\n</div>'),a.put("views/recipe-tools/main.html",'<div class="recipe-tool container" ng-class="vm.selectedStore" choose-retailer-overlay-manager track-event="{ action: \'view\', label: vm.selectedStore.id || \'unbranded\' }" track-event-once-when="vm.retailerLoaded">\n    <div class="recipe-tool--header">\n        <h3>Shopping tools</h3>\n        <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" class="learn-more u-link" target="_top">How this works</a>\n        <a href="http://www.bbcgoodfood.com/shopping-list/my-shopping-list" target="_top" class="u-link shopping-list-link">View shopping list</a>\n    </div>\n    <div class="inner-container">\n        <div ng-hide="vm.selectedStore" class="choose-market-section no-smarket">\n            <h4 class="show-mobile">Shop for this recipe</h4>\n            <h4 class="show-desktop">Choose a supermarket to see prices</h4>\n            <div>\n                <div class="show-desktop price"><span class="curr-icon">£</span> 00.00</div>\n                <div choose-retailer-dropdown-manager based-on="recipetools"></div>\n                <div class="show-mobile-inline price"><span class="curr-icon">£</span> 00.00</div>\n            </div>\n        </div>\n        <div ng-show="vm.selectedStore" class="choose-market-section yes-smarket">\n            <h4>Shop for this recipe</h4>\n            <div ng-show="vm.priceLoaded">\n                <span class="total-amount"><span ng-bind="vm.totalAmount| currency : \'£\'"></span></span><span ng-show="vm.hasServes">per serving</span><span ng-show="!vm.hasServes">in total</span>\n                <div ng-show="vm.calculationEstimated" class="total-amount-warning" tooltip-timer="5000">\n                    <i class="icon icon-info-warning"><span class="sr-only">warning</span></i>\n                    <span class="tooltip tooltip--top" ng-class="{\'no-serves\': !vm.hasServes}">\n                        <div class="tooltip__inner">\n                            Average prices have been used for ingredients that are not available at your supermarket.\n                            <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" target="_top">How this works</a>\n                        </div>\n                    </span>\n                </div>\n                <div ng-show="!vm.calculationEstimated && !vm.calculationComplete" class="total-amount-warning" tooltip-timer="5000">\n                    <i class="icon icon-info-warning"><span class="sr-only">warning</span></i>\n                    <span class="tooltip tooltip--top" ng-class="{\'no-serves\': !vm.hasServes}">\n                        <div class="tooltip__inner">\n                            Please note prices for some ingredients are not available at your chosen supermarket.\n                            <a href="http://www.bbcgoodfood.com/howto/guide/buy-ingredients" target="_top">How this works</a>\n                        </div>\n                    </span>\n                </div>\n            </div>\n            <div ng-show="vm.priceLoading" class="price-loading"><span>Calculating price...</span></div>\n            <div ng-show="vm.priceLoadingFailed" class="price-loading-failed">\n                <span>Sorry price currently unavailable. <a href="" ng-click="getRecipePrice()">Try again</a></span>\n            </div>\n            <span>Your supermarket</span>:\n            <span class="{{vm.selectedStore.id}} sprite retailer-{{vm.selectedStore.id}}">{{ vm.selectedStore.alt}}</span>\n            <a ng-click="chooseStoreOverlayOpen()" class="change-smarket-link u-link" href="" ng-show="vm.selectedStore">Change</a>\n        </div>\n        <div class="shop-meal-section">\n            <div id="mealPlanDropDown" class="shop-meal-inner" ng-class="{show: vm.showMealPlan}">\n                <h4>Add ingredients to:</h4>\n                <div>\n                    <span my-shopping-list-button-manager recipes="vm.recipeIds" based-on="recipetools" selected-store="vm.selectedStore"></span>\n                    <span class="btn-text-aside">to plan<span class="layout-lg-inline"> your shop</span></span>\n                </div>\n                <div>\n                    <span choose-retailer-button-manager selected-store="vm.selectedStore" recipes="vm.recipeIds" basket-overlay-open-fn="basketOverlayOpen()" choose-store-overlay-open-fn="chooseStoreOverlayOpenAndRedirect()" choose-store-overlay-open-no-redirect-fn="chooseStoreOverlayOpen()"></span>\n                </div>\n                <div ng-if="vm.shouldDisplayAlert" add-button-alert class="retailer-{{ vm.selectedStore.id }}" selected-store="vm.selectedStore" on-continue="onAddButtonAlertContinue()">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="recipe-tool--footer">\n        <a href="http://www.bbcgoodfood.com/shopping-list/my-shopping-list" target="_top" class="u-link shopping-list-link">View shopping list</a>\n    </div>\n</div>'),a.put("views/select-retailer-dropdown/main.html",'<div class="select-retailer-drowpdown">\n    <div class="show-desktop">\n        <ul>\n            <li ng-repeat="retailer in vm.retailers">\n                <a href="" ng-click="selectStore(retailer.id)">\n                    <span class="sprite retailer-{{retailer.id}}">{{retailer.alt}}</span>\n                </a>\n            </li>\n        </ul>\n    </div>\n    <div class="show-mobile select-retailer-mobile modal modal-inner-layout">\n        <a href="" ng-click="close()" class="modal-close pull-right"><i class="icon icon-cross"></i></a>\n        <h3>Choose a supermarket</h3>\n        <div super-market-buttons-component close="close"></div>\n    </div>\n</div>'),a.put("views/select-retailer-overlay/main.html",'<div class="modal select-ret-overlay" track-event-global-esc="dismissTrackEvent()" track-event-outer-click="dismissTrackEvent()">\n    <div class="modal-inner">\n        <div class="modal-inner-layout">\n            <a href="" class="modal-close pull-right" ng-click="close()" track-event-click="dismissTrackEvent()"> <i class="icon icon-cross"></i></a>\n            <h3 ng-show="vm.retailerKnown" class="border">Change supermarket</h3>\n            <h3 ng-show="!vm.retailerKnown" class="border">Choose a supermarket</h3>\n            <div super-market-buttons-component close="close" initial-retailer="vm.initialRetailer" add-to-basket-redirect="vm.addToBasketRedirect"></div>\n        </div>\n    </div>\n</div>'),a.put("views/shopping-list-added/main.html",'<div class="tooltip tooltip--top tooltip--visible tooltip--add-recipe">\n    <div class="tooltip__inner">\n        <p ng-show="vm.masterType == \'recipe\'">This recipe has been added to your shopping list</p>\n        <p ng-show="vm.masterType == \'mealplan\'">Your selected recipes have been added to your shopping list</p>\n        <a href="http://www.bbcgoodfood.com/shopping-list/my-shopping-list" target="_top">View shopping list</a>\n    </div>\n</div>'),a.put("views/shopping-list-already-added/main.html",'<div class="tooltip tooltip--top tooltip--visible tooltip--add-recipe">\n    <div class="tooltip__inner">\n        <p>You already added this {{vm.masterType}} to your shopping list, are you sure you want to add it again?</p>\n        <button class="btn btn-small" ng-click="close(true)">Yes</button>\n        <button class="btn btn-small" ng-click="close(false)">No</button>\n    </div>\n</div>'),a.put("views/shopping-list/shopping-list.html",'<div class="shopping-list" choose-retailer-overlay-manager track-event="{ action: \'view\', \'label\': (vm.selectedStore.id || \'unbranded\'), value: vm.recipes.length }" track-event-once-when="!vm.loadShoppingList.loading">\n    <div class="print-only header"><img src="https://di0rl3y8b5d1b.cloudfront.net/images/dab1384e.logo-lg-print.jpg" alt="BBC GoodFood"></div>\n\n    <div ng-show="vm.loadShoppingList.loaded && vm.recipes.length" style="text-align: right">\n        <a href="" class="clear-list" ng-click="vm.showClearListDialog = true"><span>Clear list</span> <i class="icon icon-cross"></i></a>\n        <div class="clear-list-dialog double-confirm-dialog" ng-class="{show: vm.showClearListDialog}">\n            <p>Are you sure you want to clear this shopping list?</p>\n            <button ng-click="clearShoppingList()" track-event-click="{ action: \'clear-list\', value: (vm.recipes|openRecipeIds).length }">Yes</button>\n            <button ng-click="vm.showClearListDialog = false">No</button>\n        </div>\n    </div>\n    <hr ng-show="vm.loadShoppingList.loaded && vm.recipes.length" class="hr-top dotted">\n    <h3 class="border print-only"><span class="date">Shopping list &mdash; {{ vm.date | date: \'d MMM\' }}</span></h3>\n    \n    <div ng-show="vm.loadShoppingList.loading">\n        Loading your shopping list...\n    </div>\n    <div ng-show="vm.loadShoppingList.loadingFailed">\n        Sorry we could not load your shopping list. Please <a href="" ng-click="getShoppingList()">try again</a>.\n    </div>\n    <div class="tab-content empty-shopping-list" ng-show="vm.loadShoppingList.loaded && !vm.recipes.length">\n        <div class="box">\n            <p>You haven\'t added any recipes to your shopping list yet</p>\n            <p>Get started by adding recipes to your list</p>\n            <div class="img-recipe-tool"> <span class="img-arrow"></span> </div>\n        </div>\n        <div class="img-empty-shopping-list"></div>\n    </div>\n    <div id="tabContent " class="tab-content" ng-show="vm.loadShoppingList.loaded && vm.recipes.length" ng-class="{\'no-hover\': !vm.hoverEnabled}">\n        <div class="recipe-list">\n            {{ (vm.recipes | filter:{isDeleted:false}).length}}\n            recipe{{ ((vm.recipes | filter:{isDeleted:false}).length) >= 2? \'s\' :\'\' }} in this list\n            <div class="toggle-handle">\n                <a href="" ng-click="toggleCarousel()" ng-show="!vm.showRecipes" track-event-click="{ action: \'open-carousel\', value: (vm.recipes|openRecipeIds).length }">Show recipes <i class="icon icon-arrow-right"></i></a>\n                <a href="" ng-click="toggleCarousel()" ng-show="vm.showRecipes" track-event-click="{ action: \'close-carousel\', value: (vm.recipes|openRecipeIds).length }">Hide recipes <i class="icon icon-arrow-down"></i></a>\n            </div>\n\n            <div ng-show="vm.showRecipes" shopping-list-carousel="vm.shoppingList" recipes="vm.recipes" get-ingredients-fn="getIngredients()" clear-ingredients-fn="clearIngredients()" updating-recipe-var="vm.updatingRecipe"></div>\n        </div>\n\n        <div ng-show="(vm.recipes | filter:{isDeleted:false}).length" class="show-desktop box send-to-section">\n            <span class="send-to-section__text">Send <span class="layout-lg-inline">this shopping </span>list to:</span>\n            <button class="btn btn-lg--has-icon btn-bbcgf btn-purple" print-manager-no-overlay ng-class="{disabled: vm.updatingRecipe}" track-event-click="{ action: \'print\', label: (vm.selectedStore.id || \'unbranded\'), value: (vm.recipes|openRecipeIds).length }">Print\n                <span class="pull-right btn__icon-wrapper"><i class="icon icon-print-bbcgf right border"></i></span>\n            </button>\n            <span class="send-to-section__text">or</span>\n            <div class="send-to-section__basket-wrapper">\n               <span choose-retailer-button-manager is-shopping-list="true" selected-store="vm.selectedStore" disable-buttons="vm.updatingRecipe" recipes="vm.recipes" basket-overlay-open-fn="basketOverlayOpen()" choose-store-overlay-open-fn="chooseStoreOverlayOpenAndRedirect()" choose-store-overlay-open-no-redirect-fn="chooseStoreOverlayOpen()"></span>\n            <a ng-click="chooseStoreOverlayOpen()" class="u-link" href="" ng-show="vm.selectedStore">Change supermarket</a>\n            </div>\n            <div class="disable-send-to-section" ng-show="vm.updatingRecipe"></div>\n        </div>\n        <div ng-show="(vm.recipes | filter:{isDeleted:false}).length" class="show-mobile box send-to-section">\n            <span class="send-to-section__text">Send <span class="layout-lg-inline">this shopping </span>list to:</span>\n            <span class="send-to-section__actions-wrapper">\n                <span choose-retailer-button-manager is-shopping-list="true" selected-store="vm.selectedStore" recipes="vm.recipes" disable-buttons="vm.updatingRecipe" recipes="vm.recipes" basket-overlay-open-fn="basketOverlayOpen()" choose-store-overlay-open-fn="chooseStoreOverlayOpenAndRedirect()" choose-store-overlay-open-no-redirect-fn="chooseStoreOverlayOpen()"></span>\n                <a ng-click="chooseStoreOverlayOpen()" class="u-link" href="" ng-show="vm.selectedStore">Change supermarket</a>\n            </span>\n            <div class="disable-send-to-section" ng-show="vm.updatingRecipe"></div>\n        </div>\n        <p ng-show="!vm.loadIngredients.loading && vm.loadIngredients.loaded && (vm.recipes | filter:{isDeleted:false}).length" class="show-desktop">Printing this list? Anything you un-tick <span class="checkbox checked"></span> will be crossed off the printed list.</p>\n\n        <div ng-show="vm.loadIngredients.loading">Loading ingredients...</div>\n        <ul ng-show="!vm.loadIngredients.loading && vm.loadIngredients.loaded && (vm.recipes | filter:{isDeleted:false}).length" class="ingredient-list">\n            <li ng-repeat="group in vm.ingredients" class="ingredients-group">\n                <h3>{{ group.name }}</h3>\n                <ul>\n                    <li ng-repeat="ingredient in group.ingredients" ng-click="ingredient.isChecked = !ingredient.isChecked">\n                        <div class="checkbox" ng-class="{checked: ingredient.isChecked}"></div><span>{{ ingredient.name }}</span>\n                    </li>\n                </ul>\n            </li>\n        </ul>\n    </div>\n</div>'),
a.put("views/shopping-list/standalone.html",'<div class="shopping-list-standalone-wrapper waitrose">\n    <h1>Shopping list</h1>\n    <p>Easy lamb tagine, Prawn, butternut &amp; mango curry, Falafels with houmous &amp; tabbouleh</p>\n\n    <ul class="ingredient-list">\n        <li ng-repeat="group in vm.ingredients">\n            <h2>{{ group.name }}</h2>\n            <ul>\n                <li ng-repeat="ingredient in group.ingredients" ng-click="ingredient.isChecked = !ingredient.isChecked">\n                    <div class="checkbox" ng-class="{checked: ingredient.isChecked}"></div>\n                    <span>{{ ingredient.name }}</span>\n                </li>\n            </ul>\n        </li>\n    </ul>\n</div>'),a.put("views/sms-overlay/main.html",'<div class="modal sms-overlay">\n    <div class="modal-inner">\n        <div class="modal-inner-layout">\n            <a href="" class="modal-close pull-right" ng-click="close()"><i class="icon icon-cross"></i></a>\n            <h3>Send a link of your list via SMS</h3>\n\n            <main>\n                <img src="https://di0rl3y8b5d1b.cloudfront.net/images/556220ed.phone.png" class="pull-right">\n\n                <p>Enter your mobile number, and we\'ll send you a SMS link to your Shopping List.</p>\n                <div class="input-group">\n                    <label for="mobile-number">Enter your mobile number:</label>\n                    <input type="tel" pattern="[0-9]{11,}" name="mobile-number" id="mobile-number">\n                    <button class="btn btn-retailer btn-blue" type="submit"><i class="icon icon-mobile left"></i> Send to mobile</button>\n                </div>\n            </main>\n        </div>\n    </div>\n</div>'),a.put("templates/gf-shared/add-button-alert-tpl.html",'<p>You can now send ingredients<br>straight to your {{ selectedStore.alt }} {{ selectedStore.basketName }}!</p>\n<button ng-click="onContinue()" class="btn btn-store {{selectedStore.id}}">Got it</button>'),a.put("templates/gf-shared/choose-retailer-button-manager-tpl.html",'<button ng-click="chooseStoreOverlayOpen()" ng-hide="selectedStore" class="btn btn-bbcgf btn-purple btn-lg btn-lg--has-icon" ng-class="{ \'disabled\' : disableButtons }">\n    Online basket <span class="pull-right btn__icon-wrapper"><i class="icon icon-cart right border"></i></span>\n</button>\n\n<button ng-show="selectedStore && selectedStore.available" class="btn btn-store {{ selectedStore.id}}" ng-class="{ \'btn-disabled\' : disableButtons }" ng-click="basketOverlayOpen()" track-event-click="{ action: selectedStore.id + \'-add-to-basket\', recipes: (recipes|openRecipeIds|separatedList), value: (recipes|openRecipeIds).length }">\n    <span class="sprite retailer-{{ selectedStore.id }}-alt">{{ selectedStore.alt}}</span>{{ selectedStore.basketName}}\n</button>\n\n<span ng-show="selectedStore && !selectedStore.available" ng-click="showUnavailableStoreTip()" ng-mouseover="showUnavailableStoreTip()" ng-mouseleave="hideUnavailableStoreTip()">\n    <button class="btn btn-bbcgf btn-purple btn-lg btn-lg--has-icon disabled">\n        Online basket <span class="pull-right btn__icon-wrapper"><i class="icon icon-cart right border"></i></span>\n    </button>\n    <span class="tooltip tooltip--bottom tooltip--a2b" ng-class="{show: vm.unavailableStore}">\n        <div class="tooltip__inner">\n            <span ng-show="isShoppingList">We&rsquo;re sorry but you can&rsquo;t buy online with {{selectedStore.alt}} yet. But it&rsquo;s coming soon.</span>\n            <span ng-show="!isShoppingList">We&rsquo;ve estimated the price, but you can&rsquo;t buy online with {{selectedStore.alt}} just yet. It&rsquo;s coming soon.</span>\n            <a href="" ng-click="chooseStoreOverlayOpenAndCloseTooltip()">Change supermarket</a>\n        </div>\n    </span>\n</span>\n\n<span class="btn-text-aside">to buy<span class="layout-lg-inline"> online</span></span>'),a.put("templates/gf-shared/choose-retailer-dropdown-tpl.html",'<span>\n    <button id="choose-retailer-dropdown" class="btn btn-bbcgf dropdown" ng-click="chooseRetailerDropdownOpen()" track-event-click="{ action: \'select-retailer-dropdown\', label: \'dismiss\' }" track-event-condition="{{ vm.isDropdownOpen }}">Choose a supermarket</button>\n</span>'),a.put("templates/gf-shared/my-shopping-list-button-manager-tpl.html",'<span class="btn-wrapper">\n    <button id="addToShoppingListBtn" class="btn btn-bbcgf btn-purple btn-lg btn-lg--has-icon btn--my-shopping-list" ng-click="sendToShoppingListHandler()" track-event-click="{ action: (selectedStore ? selectedStore.id : \'unbranded\') + \'-add-to-list\', recipes: (recipes | separatedList), value: recipes.length }" track-event-condition="{{ !vm.sending }}">My Shopping List\n      <span class="pull-right btn__icon-wrapper"><i class="icon right border" ng-class="{ \'icon-notebook\': !vm.isShoppingListModalOpen && !vm.sending && !vm.sendingFailed, \'icon-check\': vm.isShoppingListModalOpen, \'icon-cross\': vm.sendingFailed, \'icon-spinner\': vm.sending}"></i></span>\n    </button>\n</span>'),a.put("templates/gf-shared/shopping-list-carousel-tpl.html",'<div id="carouselBasic" class="carousel" ng-swipe-left="scrollRight()" ng-swipe-right="scrollLeft()">\n    <ul class="carousel-slides" ng-style="{width: calcuateWidthOfUlComponent() + \'px\', \'left\': vm.carousel_ul_left + \'px\' }">\n        <li ng-repeat="recipe in recipes" ng-class="{deleted: recipe.isDeleted, updating: updatingRecipe.id === recipe.id}" shopping-list-carousel-item-manager>\n            <div ng-show="!vm.calculationComplete" class="delete" ng-click="deleteRecipe(recipe)" track-event-click="{ action: \'delete-recipe\' }">\n                <i class="icon icon-cross"></i>\n                <span class="tooltip tooltip--top">\n                    <div class="tooltip__inner">Click to remove this recipe from your list</div>\n                </span>\n            </div>\n            <figure ng-class="{\'no-image\' : !recipe.thumb}">\n                <img ng-show="recipe.thumb" ng-src="{{ recipe.thumb}}">\n                <figcaption ng-show="recipe.caption && recipe.caption !== \'\'" class="inner">{{ recipe.caption}}</figcaption>\n            </figure>\n            <a href="" class="undo" ng-click="deleteRecipeUndo(recipe)" track-event-click="{ action: \'undo-delete\' }"><i class="icon icon-reload"></i>undo</a>\n            <a href="" class="processing"> <span><i class="icon icon-spinner"></i></span>Loading ingredients...</a>\n            <span class="recipe-link">\n                <a href="{{ recipe.url }}" target="_top">{{ recipe.name }}</a>\n                <span class="grey-out" ng-show="vm.busyManagingRecipe && updatingRecipe.id == recipe.id"></span>\n            </span>\n            <div ng-show="vm.busyManagingRecipe && updatingRecipe.id !== recipe.id" class="grey-out"></div>\n        </li>\n    </ul>\n    <a href="" class="carousel-left" ng-show="vm.leftArrowVisible" ng-click="scrollLeft()"><span class="arrow"></span></a>\n    <a href="" class="carousel-right" ng-show="vm.rightArrowVisible" ng-click="scrollRight()"><span class="arrow"></span></a>\n</div>'),a.put("templates/gf-shared/super-market-buttons-component-tpl.html",'<div class="smarket-component">\n    <div ng-repeat="button in buttons">\n        <button ng-click="selectSMarket(button.id)" ng-class="{ selected: button.selected }" class="btn btn-smarket">\n            <span class="tick-box"></span>\n            <span class="img-wrap">\n                <span class="sprite retailer-{{button.id}}">{{ button.alt}}</span>\n                <i class="star-disclaimer" ng-hide="button.available">*</i>\n            </span>\n        </button>\n    </div>\n</div>\n<div>\n    <div ng-show="vm.initialOverlayOnly" class="don-t-worry">Don\'t worry, you can change this later</div>\n    <button ng-click="confirmSelection()" class="btn btn-bbcgf smarket-component-confirm-btn" track-event-queue="{ action: (vm.initialOverlayOnly ? \'select-retailer\' : (vm.initialRetailer || \'unbranded\') + \'-change-retailer-overlay\'), label: selectedStore, value: \'seconds\' }" track-event-condition="{{ selectedStore && !addToBasketRedirect }}">\n        Save choice\n        <span id="confirmSMarketError" class="confirm-smarket-error" ng-class="{ show: vm.showConfirmErr}">Select a supermarket first</span>\n    </button>\n    <a ng-show="vm.initialOverlayOnly" href="" class="dismiss-link" ng-click="close()" track-event-click="{ action: \'dismiss\', label: \'not-now\', value: \'seconds\' }">Not right now</a>\n    <a ng-show="!vm.initialOverlayOnly && vm.initialRetailer" id="btn-clear-retailer" href="" ng-click="clearRetailer()" class="dismiss-link" track-event-click="{ action: vm.initialRetailer + \'-change-retailer-overlay\', label: \'none-of-these\'}">None of these</a>\n    <div class="text-disclaimer">*We&rsquo;ve estimated recipe prices, but you can&rsquo;t buy online with this retailer just yet. <span class="nowrap">It&rsquo;s coming soon.</span></div>\n</div>')}]),angular.module("gfSharedApp").constant("projectConstants",{ANALYTICS_PROJECT_ID:51,ANALYTICS_TRACKING_URL:"/reporting/track-cloudlist",ANALYTICS_DEFAULT_EVENT_TYPE_ID:24,ANALYTICS_CLIENT_EVENT_ID:"bbcgf-ccevent",ANALYTICS_CLIENT_EVENT_FILTER:{category:"category",action:"action",label:"label",value:"value",recipes:"label"},CALCULATE_COST_URL:"/shopping-list/calculate-cost?recipeOriginalIds={recipe-original-ids}&storeId={store-id}&publisherId=5",GET_INGREDIENTS_URL:"/shopping-list/{shopping-list-id}/ingredients?apiKey={api-key}",GET_MEAL_PLAN_RECIPES_URL:"/shopping-list/0/meal-plans/{meal-plan-id}/recipes",GET_CLOUDLIST_DEFAULT_URL:"/shopping-list/default?apiKey={api-key}",GET_CLOUDLIST_DEFAULT_NO_CREATION_URL:"/shopping-list/default?apiKey={api-key}&noCreation=1",DELETE_SHOPPABLE_OBJECT:"/shopping-list/{shopping-list-id}/{object-type}/{object-id}?apiKey={api-key}",DELETE_RECIPE_FROM_MEAL_PLAN:"/shopping-list/{shopping-list-id}/meal-plans/{meal-plan-id}/recipes/{recipe-id}?apiKey={api-key}",ADD_RECIPES_URL:"/shopping-list/{shopping-list-id}?apiKey={api-key}",ADD_RECIPES_TO_MEAL_PLAN_URL:"/shopping-list/{shopping-list-id}/meal-plans/{meal-plan-id}?apiKey={api-key}",ADD_MEALPLAN_URL:"/shopping-list/{shopping-list-id}/meal-plans/{meal-plan-id}?apiKey={api-key}",CLEAR_SHOPPING_LIST_URL:"/shopping-list/{shopping-list-id}?apiKey={api-key}",GET_RETAILERS_URL:"/retailers?appId={app-id}&apiKey={api-key}",DEBUG_LOGS_ENABLED:!1}),angular.module("gfSharedApp").directive("chooseRetailerDropdownManager",["constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","analyticsService",function(a,b,c,d){return{restrict:"EA",replace:!0,templateUrl:b.genAppTemplatesUrl()+"gf-shared/choose-retailer-dropdown-tpl.html",scope:{basedOn:"@"},link:function(e,f,g){var h=document.getElementById("choose-retailer-dropdown");e.vm={isDropdownOpen:!1},e.elementDropdownPosition=b.getElementPosition(h),e.chooseRetailerDropdownOpen=function(){e.vm.isDropdownOpen?e.chooseRetailerDropdownClose():(e.elementDropdownPosition=b.getElementPosition(h),c.sendMessage({action:"cco-render-assoc-widget",url:b.genAppUrl("selectretailerdropdown"),appType:"selectretailerdropdown",width:215,height:263,hasBackdrop:!1,trackingContext:d.getContext(),behaviorDesktop:"relative",positionDesktop:{basedOn:e.basedOn,offsetTop:e.elementDropdownPosition.y+h.offsetHeight,offsetLeft:e.elementDropdownPosition.x},behaviorMobile:"mobileaffix",mobileBreakpoint:821}),e.vm.isDropdownOpen=!0)},e.chooseRetailerDropdownClose=function(){e.vm.isDropdownOpen&&(c.sendMessage({action:"cco-destroy-widget",targetWidget:"selectretailerdropdown"}),e.vm.isDropdownOpen=!1)},e.$watch(function(){return a.opts.dimensions},function(a){var d=b.getElementPosition(h);e.elementDropdownPosition!==d&&(e.elementDropdownPosition=d,e.vm.isDropdownOpen&&c.sendMessage({action:"resize-iframe",targetWidget:"selectretailerdropdown",positionDesktop:{offsetTop:e.elementDropdownPosition.y+h.offsetHeight,offsetLeft:e.elementDropdownPosition.x}}))}),e.$watch(function(){return a.lastRawMessage.msg},function(a){"closing-select-retailer-dropdown"===a.action&&e.chooseRetailerDropdownClose()},!0)}}}]),angular.module("gfSharedApp").directive("chooseRetailerOverlayManager",["constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","analyticsService",function(a,b,c,d){return{restrict:"EA",scope:!1,link:function(e,f,g){e.openA2bOnRetailerChange=!1,e.chooseStoreOverlayOpenAndRedirect=function(){e.openA2bOnRetailerChange=!0,e.chooseStoreOverlayOpen("unbranded-add-to-basket")},e.chooseStoreOverlayOpen=function(a){c.sendMessage({action:"cco-render-assoc-widget",url:b.genAppUrl("selectretaileroverlay"),appType:"selectretaileroverlay",customData:"undefined"!=typeof a?a:"",trackingContext:d.getContext(),behaviorDesktop:"static",behaviorMobile:"mobileaffix",width:600,height:330,mobileBreakpoint:821})},e.chooseRetailerOverlayClose=function(){c.sendMessage({action:"cco-destroy-widget",targetWidget:"selectretaileroverlay"})},e.$watch(function(){return a.lastRawMessage.msg},function(a){("closing-select-retailer-overlay"===a.action||"destroyed-widget"===a.action&&"selectretaileroverlay"==a.data.widgetName)&&(e.openA2bOnRetailerChange=!1,e.chooseRetailerOverlayClose())},!0)}}}]),angular.module("gfSharedApp").directive("chooseRetailerButtonManager",["$log","$timeout","constantcoAppHelperService","constantcoFrameCommService","retailerService","predictRetailerExperimentService",function(a,b,c,d,e,f){return{restrict:"EA",templateUrl:c.genAppTemplatesUrl()+"gf-shared/choose-retailer-button-manager-tpl.html",scope:{isShoppingList:"@",basedOn:"@",selectedStore:"=",recipes:"=",basketOverlayOpenFn:"&",chooseStoreOverlayOpenFn:"&",chooseStoreOverlayOpenNoRedirectFn:"&",disableButtons:"="},link:function(c,d,f){c.vm={unavailableStore:!1};var g;c.showUnavailableStoreTip=function(){c.vm.unavailableStore=!0,g&&b.cancel(g),g=b(function(){c.vm.unavailableStore=!1},5e3)},c.hideUnavailableStoreTip=function(){c.vm.unavailableStore=!1},c.chooseStoreOverlayOpenAndCloseTooltip=function(){b.cancel(g),c.vm.unavailableStore=!1,c.chooseStoreOverlayOpenNoRedirectFn()},c.chooseStoreOverlayOpen=function(){c.chooseStoreOverlayOpenFn()},c.basketOverlayOpen=function(){var b=e.getMatchingV2SingleImplicitRetailer()||e.getActivePredictedRetailer();b&&b===e.getSelectedRetailer()&&e.setSelectedRetailer(b.id),a.debug("scope.basketOverlayOpenFn"),c.basketOverlayOpenFn()}}}}]),angular.module("gfSharedApp").directive("myShoppingListButtonManager",["$filter","cmsService","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","analyticsService",function(a,b,c,d,e,f){return{restrict:"EA",replace:!0,templateUrl:d.genAppTemplatesUrl()+"gf-shared/my-shopping-list-button-manager-tpl.html",scope:{basedOn:"@",recipes:"=",mealPlanInternalId:"=",selectedStore:"="},link:function(g,h,i){function j(){g.sendToShoppingList("add-recipe")}function k(){g.sendToShoppingList("add-to-plan")}function l(a){m=d.getElementPosition(h[0]),e.sendMessage({action:"cco-render-assoc-widget",url:d.genAppUrl(a),appType:a,customData:g.mealPlanInternalId?"mealplan":"recipe",trackingContext:f.getContext(),behaviorDesktop:"relative",width:300,height:128,hasBackdrop:!1,positionDesktop:{basedOn:g.basedOn,offsetTop:m.y+h[0].offsetHeight,offsetLeft:m.x-3}})}var m={};g.vm={mealPlanId:0,isShoppingListModalOpen:!1,isAlreadyInShoppingListModalOpen:!1,shoppingList:{},sending:!1,sendingFailed:!1},g.sendToShoppingList=function(a){var c;switch(a){case"add-to-plan":c=b.addRecipesToMealPlan(g.vm.shoppingList.id,g.vm.mealPlanId,g.recipes);break;case"add-to-new-plan":c=b.addMealPlan(g.vm.shoppingList.id,g.mealPlanInternalId,g.recipes);break;case"add-recipe":c=b.addRecipes(g.vm.shoppingList.id,g.recipes)}c&&(c.then(function(a){a&&a.success?g.shoppingListAddedOpen():g.vm.sendingFailed=!0},function(a){g.vm.sendingFailed=!0}),c["finally"](function(){g.vm.sending=!1}))},g.sendToShoppingListHandler=function(){if(!g.vm.sending&&g.recipes.length&&!g.vm.isShoppingListModalOpen){g.vm.sending=!0,g.vm.sendingFailed=!1;var c=b.getDefaultShoppingList();c.then(function(b){if(b&&b.success)if(g.vm.shoppingList=b.data,g.mealPlanInternalId){var c=a("filter")(b.data.shoppableObjects,{internalId:g.mealPlanInternalId})[0];if(c)return g.vm.mealPlanId=c.id,g.alreadyAddedCallback=k,void g.shoppingListAlreadyAddedOpen(c);g.sendToShoppingList("add-to-new-plan")}else{var d=a("filter")(b.data.shoppableObjects,function(b,c){return b.externalId&&a("filter")(g.recipes,b.externalId).length?!0:!1}).length;if(d)return g.alreadyAddedCallback=j,void g.shoppingListAlreadyAddedOpen();g.sendToShoppingList("add-recipe")}},function(a){g.vm.sendingFailed=!0,g.vm.sending=!1})}},g.shoppingListAddedOpen=function(){g.vm.isShoppingListModalOpen||(l("shoppinglistadded"),g.vm.isShoppingListModalOpen=!0)},g.shoppingListAlreadyAddedOpen=function(){g.vm.isAlreadyInShoppingListModalOpen||(l("shoppinglistalreadyadded"),g.vm.isAlreadyInShoppingListModalOpen=!0)},g.$watch(function(){return c.opts.dimensions},function(a){if(g.vm.isShoppingListModalOpen||g.vm.isAlreadyInShoppingListModalOpen){var b=d.getElementPosition(h[0]),c=g.vm.isShoppingListModalOpen?"shoppinglistadded":"shoppinglistalreadyadded";(m.x!==b.x||m.y!==b.y)&&(m=b,e.sendMessage({action:"resize-iframe",targetWidget:c,positionDesktop:{offsetTop:m.y+h[0].offsetHeight,offsetLeft:m.x}}))}}),g.$watch(function(){return c.lastRawMessage},function(a){a.msg&&"destroyed-widget"==a.msg.action&&("shoppinglistadded"==a.msg.data.widgetName?g.vm.isShoppingListModalOpen=!1:"shoppinglistalreadyadded"==a.msg.data.widgetName&&(g.vm.isAlreadyInShoppingListModalOpen=!1,a.msg.data.customData&&1==a.msg.data.customData&&g.alreadyAddedCallback?(g.alreadyAddedCallback(),g.alreadyAddedCallback=null):a.msg.data.customData===!1?g.vm.sending=!1:(g.vm.sending=!1,g.vm.sendingFailed=!0)))},!0)}}}]),angular.module("gfSharedApp").directive("superMarketButtonsComponent",["$timeout","constantcoAppHelperService","retailerService","analyticsService",function(a,b,c,d){return{restrict:"EA",templateUrl:b.genAppTemplatesUrl()+"gf-shared/super-market-buttons-component-tpl.html",scope:{closeDialog:"=close",initialRetailer:"=",addToBasketRedirect:"=",initialOverlayOnly:"@"},link:function(b,e,f){b.selectedStore,b.buttons=c.getRetailers();document.getElementById("confirmSMarketError");b.vm={initialRetailer:b.initialRetailer,addToBasketRedirect:b.addToBasketRedirect,initialOverlayOnly:b.initialOverlayOnly?!0:!1,showConfirmErr:!1},b.selectSMarket=function(a){b.selectedStore!==a&&(angular.forEach(b.buttons,function(b){b.selected=b.id==a?!0:!1}),b.selectedStore=a,b.hideError())},b.confirmSelection=function(){if(!b.selectedStore)return void b.showError();var a=b.selectedStore;c.setSelectedRetailer(a),d.triggerEventQueue(),b.closeDialog()},b.clearRetailer=function(){c.clearRetailer(),b.closeDialog()},b.close=function(){b.closeDialog()},b.showError=function(){b.vm.showConfirmErr=!0,a(function(){b.vm.showConfirmErr=!1},3e3)},b.hideError=function(){b.vm.showConfirmErr=!1},b.$watch("initialRetailer",function(a){b.vm.initialRetailer=a})}}}]),angular.module("gfSharedApp").directive("printManagerNoOverlay",function(){return{restrict:"EA",scope:{callbackFn:"="},link:function(a,b,c){b.bind("click",function(){a.sendToPrint()}),a.sendToPrint=function(){window.print(),a.callbackFn&&a.callbackFn()}}}}),angular.module("gfSharedApp").directive("shoppingListCarousel",["constantcoAppHelperService","constantcoAppConfig","userService",function(a,b,c){return{restrict:"EA",templateUrl:a.genAppTemplatesUrl()+"gf-shared/shopping-list-carousel-tpl.html",replace:!0,scope:{shoppingList:"=shoppingListCarousel",recipes:"=",getIngredientsFn:"&",clearIngredientsFn:"&",updatingRecipe:"=updatingRecipeVar"},link:function(a,c,d){function e(){return Math.floor(j.offsetWidth/(h+2*i))}function f(){if(a.vm.leftArrowVisible=!0,a.vm.rightArrowVisible=!0,j.offsetWidth>k&&j.offsetWidth>0)return void g();a.vm.carousel_ul_left===l&&(a.vm.leftArrowVisible=!1);var b=0-k+j.offsetWidth;a.vm.carousel_ul_left===b&&(a.vm.rightArrowVisible=!1)}function g(){a.vm.leftArrowVisible=!1,a.vm.rightArrowVisible=!1}a.vm={busyManagingRecipe:!1,carousel_ul_left:0,leftArrowVisible:!0,rightArrowVisible:!0};var h=146,i=10,j=document.getElementById("carouselBasic");a.calcuateWidthOfUlComponent=function(){return h*a.recipes.length+2*i*a.recipes.length-2*i},a.scrollByUnit=e()?e():1;var k=a.calcuateWidthOfUlComponent(),l=0;a.scrollRight=function(){var b=a.scrollByUnit*h+a.scrollByUnit*i*2,c=0-k+j.offsetWidth;return j.offsetWidth>k?void g():void(a.vm.carousel_ul_left=a.vm.carousel_ul_left-b<c?c:a.vm.carousel_ul_left-b)},a.scrollLeft=function(){var b=a.scrollByUnit*h+a.scrollByUnit*i*2;0-k+j.offsetWidth;return j.offsetWidth>k?void g():void(a.vm.carousel_ul_left=a.vm.carousel_ul_left+b>l?l:a.vm.carousel_ul_left+b)},a.$watch(e,function(b){a.scrollByUnit=b},!0),a.$watch(a.calcuateWidthOfUlComponent,function(a){k=a},!0),a.$watch(function(){return b.opts.dimensions.width},function(b){if(k=a.calcuateWidthOfUlComponent(),j.offsetWidth>k)return a.vm.carousel_ul_left=l,void g();f();var c=0-k+j.offsetWidth;a.vm.carousel_ul_left=a.vm.carousel_ul_left<c?c:a.vm.carousel_ul_left}),a.$watch("vm.updatingRecipe",function(b){a.updatingRecipe=b}),a.$watch("vm.carousel_ul_left",f),a.$watch(function(){return j.offsetWidth},f)}}}]),angular.module("gfSharedApp").directive("shoppingListCarouselItemManager",["$filter","$log","cmsService",function(a,b,c){return{restrict:"EA",scope:!1,link:function(d,e,f){function g(){var a=d.handleIngredients();return a?void a["finally"](function(){d.vm.busyManagingRecipe=!1,d.vm.updatingRecipe=!1}):(d.vm.busyManagingRecipe=!1,void(d.vm.updatingRecipe=!1))}d.vm.updatingRecipe=!1,d.getIngredients=function(){return d.getIngredientsFn()},d.clearIngredients=function(){d.clearIngredientsFn()},d.handleIngredients=function(){return a("filter")(d.recipes,{isDeleted:!1}).length?d.getIngredients():void d.clearIngredients()},d.deleteRecipe=function(e){var f,h,i;if(d.vm.busyManagingRecipe)return!1;d.vm.busyManagingRecipe=!0,d.vm.updatingRecipe=e,e.isDeleted=!0;var j=a("filter")(d.shoppingList.shoppableObjects,{id:e.id})[0];if(h=d.shoppingList.shoppableObjects.indexOf(j),d.shoppingList.shoppableObjects.splice(h,1),j.parentId){var k=a("filter")(d.shoppingList.shoppableObjects,{id:j.parentId})[0];if(a("filter")(d.shoppingList.shoppableObjects,{parentId:j.parentId}).length)f=c.deleteRecipeFromMealPlan(d.shoppingList.id,j.parentId,e.id),f["finally"](g);else{var i=d.shoppingList.shoppableObjects.indexOf(k);b.debug(i),d.shoppingList.shoppableObjects.splice(i,1),f=c.deleteShoppableObject(d.shoppingList.id,"meal-plans",j.parentId),f["finally"](g)}}else f=c.deleteShoppableObject(d.shoppingList.id,"recipes",e.id),f["finally"](g)},d.deleteRecipeUndo=function(b){var e;if(d.vm.busyManagingRecipe)return!1;if(d.vm.busyManagingRecipe=!0,d.vm.updatingRecipe=b,b.parentId){var f=a("filter")(d.shoppingList.shoppableObjects,{id:b.parentId})[0];f?(e=c.addRecipesToMealPlan(d.shoppingList.id,f.id,[b.externalId]),e.then(function(a){a&&a.success&&a.data.length&&angular.forEach(a.data,function(a){d.shoppingList.shoppableObjects.push(a),b.id=a.id,b.parentId=a.parentId,b.isDeleted=!1})}),e["finally"](g)):(e=c.addMealPlan(d.shoppingList.id,b.parentInternalId,[b.externalId]),e.then(function(c){c&&c.success&&c.data.length&&angular.forEach(c.data,function(c){if(d.shoppingList.shoppableObjects.push(c),"recipe"==c.type){var e=b.parentId;b.id=c.id,b.parentId=c.parentId,b.isDeleted=!1;var f=a("filter")(d.recipes,{parentId:e});angular.forEach(f,function(a){a.parentId=c.parentId})}})}),e["finally"](g))}else e=c.addRecipes(d.shoppingList.id,[b.externalId]),e.then(function(a){a&&a.success&&a.data.length&&angular.forEach(a.data,function(a){d.shoppingList.shoppableObjects.push(a),b.id=a.id,b.isDeleted=!1})}),e["finally"](g)}}}}]),angular.module("gfSharedApp").directive("tooltipTimer",["$timeout",function(a){return{restrict:"EA",scope:{timer:"@tooltipTimer"},transclude:!0,replace:!0,template:'<div ng-mouseover="showTooltip()" ng-mouseleave="hideTooltip()" ng-class="{show: vm.tooltipOn}"><span ng-transclude></span></div>',link:function(b,c,d){b.vm={tooltipOn:!1};var e;b.showTooltip=function(){b.vm.tooltipOn=!0,e&&a.cancel(e),e=a(function(){b.vm.tooltipOn=!1},b.timer)},b.hideTooltip=function(){b.vm.tooltipOn=!1},c.on("touchstart",function(a){b.vm.tooltipOn||(b.showTooltip(),b.$apply())})}}}]),angular.module("gfSharedApp").factory("userService",["$q","ipCookie","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","commService",function(a,b,c,d,e,f){function g(){var b=a.defer();return f.sendMessage(parent,"cc-state-get-v2-single-implicit-retailer",{},function(a){b.resolve(a)}),b.promise}function h(){var b=a.defer();return k&&b.resolve(k),f.sendMessage(parent,"cc-state-get-state",{},function(a){k=a,b.resolve(a)}),b.promise}var i,j,k,l=function(){return c.opts.userHash},m=function(){var b=a.defer();return void 0!==i&&b.resolve(i),n().then(function(a){i=a.known,b.resolve(i)}),b.promise},n=function(){var b=a.defer();return m().then(function(a){a||b.resolve(1),o().then(function(a){b.resolve(a?3:2)})}),b.promise},m=function(){var b=a.defer();return void 0!==i&&b.resolve(i),h().then(function(a){i=a.shopper.known,b.resolve(i)}),b.promise},o=function(){var b=a.defer();return void 0!==j&&b.resolve(j),h().then(function(a){j=!!a.conSession,b.resolve(j)}),b.promise},p=function(a){i=void 0!==a?a:!0,i?f.sendMessage(parent,"cc-state-set-shopper-known"):f.sendMessage(parent,"cc-state-set-shopper-unknown")};return h(),{getUserHash:l,getShopperState:n,isKnown:m,isConnected:o,setKnown:p,getState:h,getV2SingleImplicitRetailer:g}}]),angular.module("gfSharedApp").service("cmsService",["$timeout","$q","$http","$log","userService","projectConstants","constantcoAppConfig","constantcoFrameCommService",function(a,b,c,d,e,f,g,h){var i;this.getDefaultShoppingList=function(){var a=e.getUserHash();return i&&i.resolve(),i=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.GET_CLOUDLIST_DEFAULT_URL).replace("{api-key}",a),method:"GET"}).success(function(a){i.resolve(a)}).error(function(a,b){i.reject(b)}),i.promise};var j;this.getDefaultShoppingListWithNoCreation=function(){var a=e.getUserHash();return j&&j.resolve(),j=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.GET_CLOUDLIST_DEFAULT_NO_CREATION_URL).replace("{api-key}",a),method:"GET"}).success(function(a){j.resolve(a)}).error(function(a,b){j.reject(b)}),j.promise};var k;this.addRecipes=function(a,d){var h=e.getUserHash();return k&&k.resolve(),k=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.ADD_RECIPES_URL).replace("{shopping-list-id}",a).replace("{api-key}",h),method:"POST",data:{recipeIds:d}}).success(function(a){k.resolve(a)}).error(function(a,b){k.reject(b)}),k.promise};var l;this.addRecipesToMealPlan=function(a,d,h){var i=e.getUserHash();return l&&l.resolve(),l=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.ADD_RECIPES_TO_MEAL_PLAN_URL).replace("{shopping-list-id}",a).replace("{meal-plan-id}",d).replace("{api-key}",i),method:"PUT",data:{recipeIds:h}}).success(function(a){l.resolve(a)}).error(function(a,b){l.reject(b)}),l.promise};var m;this.addMealPlan=function(a,d,h){var i=e.getUserHash();return m&&m.resolve(),m=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.ADD_MEALPLAN_URL).replace("{shopping-list-id}",a).replace("{meal-plan-id}",d).replace("{api-key}",i),method:"POST",data:{recipeIds:h}}).success(function(a){m.resolve(a)}).error(function(a,b){m.reject(b)}),m.promise};var n;this.deleteRecipeFromMealPlan=function(a,d,h){var i=e.getUserHash();return n&&n.resolve(),n=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.DELETE_RECIPE_FROM_MEAL_PLAN).replace("{shopping-list-id}",a).replace("{meal-plan-id}",d).replace("{recipe-id}",h).replace("{api-key}",i),method:"DELETE"}).success(function(a){n.resolve(a)}).error(function(a,b){n.reject(b)}),n.promise};var o;this.deleteShoppableObject=function(a,d,h){var i=e.getUserHash();return o&&o.resolve(),o=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.DELETE_SHOPPABLE_OBJECT).replace("{shopping-list-id}",a).replace("{object-type}",d).replace("{object-id}",h).replace("{api-key}",i),method:"DELETE"}).success(function(a){o.resolve(a)}).error(function(a,b){o.reject(b)}),o.promise};var p;this.clearShoppingList=function(a){var d=e.getUserHash();return p&&p.resolve(),p=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.CLEAR_SHOPPING_LIST_URL).replace("{shopping-list-id}",a).replace("{api-key}",d),method:"DELETE"}).success(function(a){p.resolve(a)}).error(function(a,b){p.reject(b)}),p.promise};var q,r={promiseStack:[],httpRequestInProcess:!1,httpCanceller:void 0};this.calculateCost=function(a,d){return r.httpRequestInProcess&&r.httpCanceller.resolve(),q=b.defer(),r.promiseStack.push(q),r.httpCanceller=b.defer(),r.httpRequestInProcess=!0,c({url:(g.opts.initSettings["api-url"]+f.CALCULATE_COST_URL).replace("{recipe-original-ids}",a).replace("{store-id}",d),method:"GET",timeout:r.httpCanceller.promise}).success(function(b){q.notify("*** promise end: "+a),r.httpRequestInProcess=!1,r.promiseStack.shift().resolve(b)}).error(function(b,c){q.notify("*** promise end: "+a),r.httpRequestInProcess=!1,r.promiseStack.shift().reject(c)}),q.promise},this.cancelAllCalculateCost=function(){for(var a=0,b=r.promiseStack.length;b>a;a++)r.promiseStack.shift().resolve({error:!1})};var s,t={promiseStack:[],httpRequestInProcess:!1,httpCanceller:void 0};this.getIngredients=function(a){var d=e.getUserHash();return t.httpRequestInProcess&&t.httpCanceller.resolve(),s=b.defer(),t.promiseStack.push(s),t.httpCanceller=b.defer(),t.httpRequestInProcess=!0,c({url:(g.opts.initSettings["api-url"]+f.GET_INGREDIENTS_URL).replace("{shopping-list-id}",a).replace("{api-key}",d),method:"GET",timeout:t.httpCanceller}).success(function(b){s.notify("*** promise end: "+a),t.httpRequestInProcess=!1,t.promiseStack.shift().resolve(b)}).error(function(b,c){s.notify("*** promise end: "+a),t.httpRequestInProcess=!1,t.promiseStack.shift().reject(c)}),s.promise};var u;this.getMealplanRecipes=function(a){return u&&u.resolve(),u=b.defer(),c({url:(g.opts.initSettings["api-url"]+f.GET_MEAL_PLAN_RECIPES_URL).replace("{meal-plan-id}",a),method:"GET"}).success(function(a){u.resolve(a)}).error(function(a,b){u.reject(b)}),u.promise};var v;this.getRetailers=function(a){var d=g.opts.appId;return v&&v.resolve(),v=b.defer(),c({url:(g.opts.initSettings["api-data-url"]+f.GET_RETAILERS_URL).replace("{app-id}",d).replace("{api-key}",a),method:"GET"}).success(function(a){v.resolve(a)}).error(function(a,b){v.reject(b)}),v.promise}}]),angular.module("gfSharedApp").factory("Experiment",function(){function a(a,b,c,d,e){this.name=a,this.chosen=b,this.normalized=c,this.data=d,this.timestamp=e}return a}),angular.module("gfSharedApp").factory("experimentService",["$q","Experiment","commService",function(a,b,c){function d(){return(void 0!==i?a.when():h()).then(function(){return a.when(i)})}function e(c){return(void 0!==j?a.when():h()).then(function(){return a.when(c in j?new b(c,j[c].chosen,j[c].normalized,j[c].data,j[c].timestamp):null)})}function f(a){c.sendMessage(parent,"cc-experiment-set-experiment",{name:a.name,chosen:a.chosen,normalized:a.normalized,data:a.data,timestamp:a.timestamp})}function g(a){a&&(a.normalized=!0,f(a))}function h(){var b=a.defer();return c.sendMessage(parent,"cc-experiment-get-experiments",{},function(a){i=a.canParticipate,j=a.experiments,b.resolve()}),setTimeout(function(){i=!1,j={},b.reject()},1e3),b.promise}var i,j;return{canParticipate:d,getExperiment:e,setExperiment:f,normalizeExperiment:g}}]),angular.module("gfSharedApp").factory("predictRetailerExperimentService",["$q","userService","experimentService","Experiment",function(a,b,c,d){function e(){return c.canParticipate().then(function(c){return c?b.getState():a.reject()}).then(function(a){return l=a.session.id,c.getExperiment(o)}).then(function(b){return n=j(b||i()),c.setExperiment(n),m=k(n),a.when(m)})["catch"](function(b){
return n=null,a.when(null)})}function f(){return m}function g(){return void 0!==n?a.when(n):c.getExperiment(o)}function h(){g().then(c.normalizeExperiment)}function i(){var a=Math.random()<p;return new d(o,a,!1,a?{storeIndex:0,sessionId:l}:{},(new Date).getTime())}function j(a){return a.chosen&&a.data.sessionId!==l&&(a.data.storeIndex=Math.min(a.data.storeIndex+1,q.length),a.data.storeIndex>=q.length&&(a.normalized=!0),a.data.sessionId=l),a}function k(a){return a.chosen&&!a.normalized?q[a.data.storeIndex]:null}var l,m,n,o="predict-store-03",p=.4,q=["tesco","tesco","tesco","asda","ocado","sainsburys"];return{getRetailer:e,getActiveRetailer:f,getActiveExperiment:g,normalizeActiveExperiment:h}}]),angular.module("gfSharedApp").factory("activityFactory",function(){function a(a,b,c,d){this.name=a,this.normalized=b,this.data=c,this.timestamp=d}return{create:function(b,c,d,e){return new a(b,c,d,e)}}}),angular.module("gfSharedApp").factory("activityService",["$q","activityFactory","commService",function(a,b,c){function d(c){return g().then(function(d){return a.when(c in d?b.create(c,d[c].normalized,d[c].data,d[c].timestamp):null)})["catch"](function(){return h=!1,a.reject()})}function e(a){h&&c.sendMessage(parent,"cc-activity-set-activity",{name:a.name,normalized:a.normalized,data:a.data,timestamp:a.timestamp})}function f(a){a&&h&&(a.normalized=!0,e(a))}function g(){var b=a.defer();return c.sendMessage(parent,"cc-activity-get-activities",{},function(a){a.canParticipate?b.resolve(a.activities||{}):b.reject()}),setTimeout(function(){b.resolve({})},1e3),b.promise}var h=!0;return{getActivity:d,setActivity:e,normalizeActivity:f}}]),angular.module("gfSharedApp").factory("sainsburysAlertActivityService",["$q","userService","activityService","activityFactory",function(a,b,c,d){function e(b){return g().then(function(c){var d=!c.normalized&&b&&"sainsburys"===b.id;return a.when(d)})["catch"](function(b){return a.when(!1)})}function f(){g().then(function(a){c.normalizeActivity(a)})}function g(){return c.getActivity(h).then(function(b){return b=b||d.create(h,!1,{},(new Date).getTime()),c.setActivity(b),a.when(b)})}var h="sainsburys-activity-01";return{shouldDisplayAlert:e,normalize:f}}]),angular.module("gfSharedApp").factory("retailerService",["$q","$filter","ipCookie","userService","constantcoAppConfig","constantcoFrameCommService","cmsService","predictRetailerExperimentService",function(a,b,c,d,e,f,g,h){function i(){var b=d.getUserHash(),c=a.defer();if(e.opts.initSettings.retailers&&e.opts.initSettings.retailers.length)n=e.opts.initSettings.retailers,c.resolve();else{var f=g.getRetailers(b);f.then(function(a){a&&a.success&&a.data.length&&(n=a.data,c.resolve())})}return c.promise}function j(){return d.getV2SingleImplicitRetailer().then(function(c){return c&&(q=b("filter")(n,{id:c.toLowerCase()})[0],q&&(e.opts.lastRetailer=q.id,z(q.id))),a.when(c)})}function k(){return h.getRetailer().then(function(b){return b?(p=b,e.opts.lastRetailer=b,z(b)):z(""),a.when(b)})}function l(){return q}function m(){if(p){var a=b("filter")(n,{id:p||0});return a.length?a[0]:null}return null}var n=[],o={retailerCookie:"last_retailer"},p=null,q=null,r=function(){return i().then(y).then(function(a){return a||j()}).then(function(a){return a||k()})},s=function(a){var c=b("filter")(n,{id:a})[0];f.sendMessage({action:"cco-set-cookie",data:{name:o.retailerCookie,value:c.externalId,expires:3650}}),z(a)},t=function(a){p=null,h.normalizeActiveExperiment(),d.setKnown(!0),e.opts.lastRetailer=a,c(o.retailerCookie,a,{expires:3650,path:"/",domain:e.opts.initSettings["cookie-domain"]}),s(a)},u=function(){return e.opts.initialRetailer||c(o.retailerCookie)},v=function(){var a=null,c=b("filter")(n,{id:e.opts.lastRetailer||0});return c.length&&(a=c[0]),a},w=function(){d.setKnown(!1),p=null,h.normalizeActiveExperiment(),e.opts.lastRetailer="",c.remove(o.retailerCookie,{path:"/",domain:e.opts.initSettings["cookie-domain"]}),f.sendMessage({action:"cco-remove-cookie",data:{name:o.retailerCookie}}),z("")},x=function(a){return b("filter")(n,{id:a}).length},y=function(){var d,f="";return c(o.retailerCookie)?(d=b("filter")(n,{id:c(o.retailerCookie)})[0],d&&(f=d.id,s(f))):null===e.opts.lastRetailer&&e.opts.initialRetailer&&(d=b("filter")(n,{externalId:e.opts.initialRetailer})[0],d&&(f=d.id,t(f))),a.when(f)},z=function(a){f.sendMessage({action:"cco-update-on-retailer-change",data:{value:a}})},A=function(a){for(var b=[],c=0;c<a.length;c++){var d=[];d.push(a[c].toString()),d.push(null),b.push(d)}return b=JSON.stringify(b)};return{fetchRetailers:function(){return r()},getRetailers:function(){return n},isValidRetailer:function(a){return x(a)},buildA2bDataString:function(a){return A(a)},setSelectedRetailer:function(a){return t(a)},hasSelectedRetailer:function(){return u()},clearRetailer:function(){return w()},updateLastRetailerFromExternalId:function(a){return updateLastRetailerFromExternalId(a)},getSelectedRetailer:v,getActivePredictedRetailer:m,getMatchingV2SingleImplicitRetailer:l}}]),angular.module("gfSharedApp").directive("addButtonAlert",["constantcoAppHelperService","sainsburysAlertActivityService",function(a,b){return{restrict:"EA",templateUrl:a.genAppTemplatesUrl()+"gf-shared/add-button-alert-tpl.html",scope:{callbackFn:"=",selectedStore:"=",onContinue:"&"}}}]),angular.module("recipeToolsApp",["ui.router","constantco","gfSharedApp","templatesCache","analytics"]),angular.module("recipeToolsApp").config(["$stateProvider","$urlRouterProvider","$injector","$logProvider","projectConstants",function(a,b,c,d,e){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"recipeToolsMainCtrl",templateUrl:"views/recipe-tools/main.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),d.debugEnabled(e.DEBUG_LOGS_ENABLED)}]),angular.module("recipeToolsApp").controller("recipeToolsMainCtrl",["$scope","$filter","userService","cmsService","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","retailerService","projectConstants","analyticsService","sainsburysAlertActivityService",function(a,b,c,d,e,f,g,h,i,j,k){a.vm={selectedStore:!1,recipeIds:[],loading:!1,loadingFailed:!1,calculationComplete:!0,calculationEstimated:!1,smarkets:h.getRetailers(),showMealPlan:!1,priceLoading:!1,priceLoaded:!1,priceLoadingFailed:!1,totalAmount:0,hasServes:!1,specOffers:"",retailerLoaded:!1,shouldDisplayAlert:!1},j.setContext("recipe-shopping-tools"),a.getRecipePrice=function(){a.vm.priceLoading=!0,a.vm.priceLoaded=!1,a.vm.priceLoadingFailed=!1;var b=d.calculateCost(a.vm.recipeIds,a.vm.selectedStore.internalId);b.then(function(b){b&&b.success&&b.data.length?(b.data[0].serves?(a.vm.totalAmount=b.data[0].priceUsedPart/b.data[0].serves.toFixed(2),a.vm.hasServes=!0):(a.vm.totalAmount=b.data[0].priceUsedPart,a.vm.hasServes=!1),a.vm.calculationComplete=b.data[0].complete,a.vm.calculationEstimated=b.data[0].estimated,a.vm.priceLoaded=!0,a.vm.priceLoadingFailed=!1):(a.totalAmount=0,a.vm.priceLoadingFailed=!0,a.vm.priceLoaded=!1)},function(b){a.totalAmount=0,a.vm.priceLoadingFailed=!0,a.vm.priceLoaded=!1}),b["finally"](function(){a.vm.priceLoading=!1})},a.basketOverlayOpen=function(){a.vm.selectedStore.available&&a.vm.recipeIds.length&&g.sendMessage({action:"cco-render-basket",url:e.opts.initSettings["a2b-url"],urlParams:{app_id:e.opts.appId,data:h.buildA2bDataString(a.vm.recipeIds)},storeId:a.vm.selectedStore.id,appType:"addtobasket",canDestroy:!1,canCloseOnOuterClick:!1,behaviorDesktop:"dynamic",behaviorMobile:"mobile",width:730,mobileBreakpoint:821,styleBgColor:"#ffffff",styleBorderWidth:6})},a.onAddButtonAlertContinue=function(){k.normalize(),a.vm.shouldDisplayAlert=!1},a.init=function(){a.vm.recipeIds.push(e.opts.appResourceId)},a.init(),a.$watch(function(){return e.opts.lastRetailer},function(c){c&&h.isValidRetailer(c)?(a.vm.selectedStore=b("filter")(a.vm.smarkets,{id:c})[0],a.getRecipePrice(),a.vm.selectedStore.available&&a.openA2bOnRetailerChange&&(j.track({action:"unbranded-add-to-basket",label:a.vm.selectedStore.id,value:1}),a.basketOverlayOpen())):a.vm.selectedStore=!1,null!==c&&(a.openA2bOnRetailerChange=!1,a.vm.retailerLoaded=!0,k.shouldDisplayAlert(h.getSelectedRetailer()).then(function(b){a.$evalAsync(function(){a.vm.shouldDisplayAlert=!!b}),b||k.normalize()}))})}]),angular.module("mealplanToolsApp",["ui.router","constantco","gfSharedApp","templatesCache","analytics"]),angular.module("mealplanToolsApp").config(["$stateProvider","$urlRouterProvider","$injector","$logProvider","projectConstants",function(a,b,c,d,e){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"mealplanToolsMainCtrl",templateUrl:"views/mealplan-tools/main.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),d.debugEnabled(e.DEBUG_LOGS_ENABLED)}]),angular.module("mealplanToolsApp").controller("mealplanToolsMainCtrl",["$scope","$filter","$log","userService","cmsService","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","retailerService","projectConstants","analyticsService",function(a,b,c,d,e,f,g,h,i,j,k){a.vm={selectedStore:!1,mealplanId:f.opts.appResourceId,mealplanRecipeIds:!1,calculationComplete:!0,calculationEstimated:!1,smarkets:i.getRetailers(),priceLoading:!1,priceProcessing:!1,priceLoaded:!1,priceLoadingFailed:!1,totalAmount:0,specOffers:"",loadRecipes:{loading:!1,loaded:!1,loadingFailed:!1},recipePriceDataSent:!1,allMealPlanRecipeIds:[]},k.setContext("meal-plan-tools"),a.getRecipesPrice=function(d,f){a.vm.priceLoading&&(a.vm.priceProcessing=!0),a.vm.priceLoading=!0,a.vm.priceLoaded=!1,a.vm.priceLoadingFailed=!1;var g=a.vm.recipePriceDataSent?d:f;c.debug("target recipes: "+g);var i=e.calculateCost(g.join(","),a.vm.selectedStore.internalId);i.then(function(e){if(e&&e.success&&e.data.length){var f=0,g=!0,i=!1;if(c.debug("trying to find "+d+" recipe id"),angular.forEach(e.data,function(a){d.indexOf(parseInt(a.originalId,10))>-1&&(f+=a.priceUsedPart,a.complete||(g=!1),1==a.estimated&&(i=!0))}),!a.vm.recipePriceDataSent){var j=b("mealPlanRecipesPriceExternal")(e.data);h.sendMessage({action:"bbcgf-recipe-costsperserving",recipes:j}),a.vm.recipePriceDataSent=!0}c.debug("* total amount "+f),a.vm.totalAmount=f.toFixed(2),a.vm.calculationComplete=g,a.vm.calculationEstimated=i,a.vm.priceLoaded=!0,a.vm.priceLoadingFailed=!1}else e&&!e.error?(a.totalAmount=0,a.vm.priceLoaded=!0,a.vm.priceLoadingFailed=!1):(a.totalAmount=0,a.vm.priceLoadingFailed=!0,a.vm.priceLoaded=!1)},function(b){c.debug("error "+b),a.totalAmount=0,a.vm.priceLoadingFailed=!0,a.vm.priceLoaded=!1},function(a){c.debug(a)}),i["finally"](function(){a.vm.priceProcessing?a.vm.priceProcessing=!1:a.vm.priceLoading=!1})},a.getRecipesPriceHandler=function(){a.vm.allMealPlanRecipeIds.length&&(a.vm.mealplanRecipeIds&&a.vm.mealplanRecipeIds.length||!a.vm.recipePriceDataSent)?a.getRecipesPrice(a.vm.mealplanRecipeIds,a.vm.allMealPlanRecipeIds):(e.cancelAllCalculateCost(),a.vm.priceLoaded=!0,a.vm.totalAmount=0,a.vm.calculationComplete=!0,a.vm.calculationEstimated=!1)},a.getMealplanRecipes=function(){a.vm.loadRecipes.loading=!0,a.vm.loadRecipes.loaded=!1,a.vm.loadRecipes.loadingFailed=!1;var b=e.getMealplanRecipes(a.vm.mealplanId);b.then(function(b){b&&(a.vm.allMealPlanRecipeIds=b.data.recipes,a.vm.mealplanRecipeIds=a.vm.mealplanRecipeIds===!1?a.vm.allMealPlanRecipeIds:a.vm.mealplanRecipeIds,a.vm.loadRecipes.loaded=!0,a.vm.selectedStore&&a.getRecipesPriceHandler())},function(b){a.totalAmount=0,a.vm.loadRecipes.loadingFailed=!0}),b["finally"](function(){a.vm.loadRecipes.loading=!1})},a.basketOverlayOpen=function(){a.vm.selectedStore.available&&a.vm.mealplanRecipeIds.length&&h.sendMessage({action:"cco-render-basket",url:f.opts.initSettings["a2b-url"],urlParams:{app_id:f.opts.appId,data:i.buildA2bDataString(a.vm.mealplanRecipeIds)},storeId:a.vm.selectedStore.id,appType:"addtobasket",behaviorDesktop:"dynamic",behaviorMobile:"mobile",canDestroy:!1,canCloseOnOuterClick:!1,width:730,mobileBreakpoint:821,styleBgColor:"#ffffff",styleBorderWidth:6})},a.init=function(){a.getMealplanRecipes()},a.init(),a.$watch(function(){return f.opts.lastRetailer},function(c){c&&i.isValidRetailer(c)?(a.vm.recipePriceDataSent=!1,a.vm.selectedStore=b("filter")(a.vm.smarkets,{id:c})[0],a.getRecipesPriceHandler(),a.vm.selectedStore.available&&a.openA2bOnRetailerChange&&(k.track({action:"unbranded-add-to-basket",label:a.vm.selectedStore.id,value:a.vm.mealplanRecipeIds.length}),a.basketOverlayOpen())):a.vm.selectedStore=!1,a.openA2bOnRetailerChange=!1}),a.$watch(function(){return f.lastRawMessage},function(b){b.msg&&"mealplanrecipes"==b.msg.action&&(a.vm.mealplanRecipeIds=b.msg.data,a.vm.selectedStore&&a.getRecipesPriceHandler())},!0)}]),angular.module("initOverlayApp",["ui.router","constantco","gfSharedApp","templatesCache","analytics"]),angular.module("initOverlayApp").config(["$stateProvider","$urlRouterProvider","$injector","$logProvider","projectConstants",function(a,b,c,d,e){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"initOverlayMainCtrl",templateUrl:"views/init-overlay/main.html"}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),d.debugEnabled(e.DEBUG_LOGS_ENABLED)}]),angular.module("initOverlayApp").controller("initOverlayMainCtrl",["$scope","$timeout","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService","retailerService","analyticsService",function(a,b,c,d,e,f,g){g.setContext("initial-overlay"),a.overlayOpen=!1,"gb"!=c.opts.initSettings["country-code"]||f.hasSelectedRetailer()||b(function(){e.sendMessage({action:"cco-render-assoc-widget",url:d.genAppUrl("initoverlaycontent"),appType:"initoverlaycontent",trackingContext:g.getContext(),behaviorDesktop:"static",behaviorMobile:"mobile",width:680,height:557,mobileBreakpoint:768}),a.overlayOpen=!0},0),a.$watch(function(){return c.opts.lastRetailer},function(b){a.overlayOpen&&b&&(e.sendMessage({action:"cco-set-cookie",data:{name:"init_overlay",value:"1",expires:"Infinity"}}),a.overlayOpen=!1)})}]),angular.module("initOverlayContentApp",["ui.router","constantco","gfSharedApp","templatesCache","analytics"]),angular.module("initOverlayContentApp").config(["$stateProvider","$urlRouterProvider","$provide","$injector","$logProvider","projectConstants",function(a,b,c,d,e,f){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"initOverlayContentMainCtrl",templateUrl:"views/init-overlay-content/main.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),e.debugEnabled(f.DEBUG_LOGS_ENABLED),c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}])}]),angular.module("initOverlayContentApp").controller("initOverlayContentMainCtrl",["$scope","$timeout","constantcoAppConfig","constantcoAppHelperService","constantcoFrameCommService",function(a,b,c,d,e){a.close=function(){e.sendMessage({action:"cco-destroy-widget",targetWidget:"initoverlaycontent"})}}]),angular.module("selectRetailerDropdownApp",["ui.router","constantco","gfSharedApp","templatesCache"]),angular.module("selectRetailerDropdownApp").config(["$stateProvider","$urlRouterProvider","$provide","$injector","$logProvider","projectConstants",function(a,b,c,d,e,f){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"selectRetailerDropdownMainCtrl",templateUrl:"views/select-retailer-dropdown/main.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),e.debugEnabled(f.DEBUG_LOGS_ENABLED),c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}])}]),angular.module("selectRetailerDropdownApp").controller("selectRetailerDropdownMainCtrl",["$scope","retailerService","userService","constantcoAppConfig","constantcoFrameCommService","analyticsService",function(a,b,c,d,e,f){a.vm={retailers:b.getRetailers()},a.selectStore=function(c){b.setSelectedRetailer(c),f.track({action:"select-retailer-dropdown",label:c}),a.close()},a.close=function(){e.sendMessage({action:"associated-widget-task",targetWidgets:["recipetools","mealplantools"],task:"closing-select-retailer-dropdown"})}}]),angular.module("selectRetailerOverlayApp",["ui.router","constantco","gfSharedApp","templatesCache"]),angular.module("selectRetailerOverlayApp").config(["$stateProvider","$urlRouterProvider","$provide","$injector","$logProvider","projectConstants",function(a,b,c,d,e,f){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"selectRetailerOverlayMainCtrl",templateUrl:"views/select-retailer-overlay/main.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),e.debugEnabled(f.DEBUG_LOGS_ENABLED),c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}])}]),angular.module("selectRetailerOverlayApp").controller("selectRetailerOverlayMainCtrl",["$scope","constantcoAppConfig","constantcoFrameCommService","retailerService","RetailerServiceData",function(a,b,c,d,e){a.vm={initialRetailer:e||!1,retailerKnown:!("unbranded-add-to-basket"==b.opts.customData),addToBasketRedirect:"unbranded-add-to-basket"==b.opts.customData},a.close=function(){c.sendMessage({action:"associated-widget-task",targetWidgets:["recipetools","mealplantools","shoppinglist"],task:"closing-select-retailer-overlay"})},a.dismissTrackEvent=function(){return{action:(a.vm.initialRetailer||"unbranded")+"-"+(a.vm.addToBasketRedirect?"add-to-basket":"change-retailer-overlay"),label:"dismiss"}}}]),angular.module("shoppingListApp",["ui.router","ngTouch","constantco","gfSharedApp","templatesCache","analytics"]),angular.module("shoppingListApp").config(["$stateProvider","$urlRouterProvider","$injector","$logProvider","projectConstants",function(a,b,c,d,e){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.shoppinglist",{url:"",controller:"shoppingListCtrl",templateUrl:"views/shopping-list/shopping-list.html",resolve:{RetailerServiceData:["retailerService",function(a){return a.fetchRetailers()}]}}),b.otherwise(function(a){var b=a.get("$state");b.go("root.shoppinglist")}),d.debugEnabled(e.DEBUG_LOGS_ENABLED)}]),angular.module("shoppingListApp").controller("shoppingListCtrl",["$q","$scope","$filter","projectConstants","cmsService","userService","retailerService","constantcoFrameCommService","constantcoAppConfig","constantcoAppHelperService","analyticsService",function(a,b,c,d,e,f,g,h,i,j,k){b.vm={loadShoppingList:{loading:!1,loaded:!1,loadingFailed:!1},loadIngredients:{loading:!1,loaded:!1,loadingFailed:!1},shoppingList:{},showRecipes:!1,recipes:[],recipeIds:[],ingredients:[],selectedStore:!1,smarkets:g.getRetailers(),date:Date.now(),showClearListDialog:!1,hoverEnabled:!0,updatingRecipe:!0},k.setContext("shopping-list"),b.getShoppingList=function(){b.vm.loadShoppingList.loading=!0,b.vm.loadShoppingList.loaded=!1,b.vm.loadShoppingList.loadingFailed=!1;var a=e.getDefaultShoppingListWithNoCreation();a.then(function(a){a&&a.success?(angular.isArray(a.data)||(b.vm.shoppingList=a.data,b.createRecipesArray(),b.vm.recipes.length&&b.getIngredients()),b.vm.loadShoppingList.loaded=!0):b.vm.loadShoppingList.loadingFailed=!0},function(a){b.vm.loadShoppingList.loadingFailed=!0}),a["finally"](function(){b.vm.loadShoppingList.loading=!1})},b.getIngredients=function(){b.vm.loadIngredients.loading=!0,b.vm.loadIngredients.loaded=!1,b.vm.loadIngredients.loadingFailed=!1;var c=a.defer(),d=e.getIngredients(b.vm.shoppingList.id);return d.then(function(a){if(a&&a.success){var d=[];angular.forEach(a.data,function(a,b){var c={name:b,ingredients:[]};angular.forEach(a,function(a){c.ingredients.push({name:a.display_measure+" "+a.product_name,isChecked:!0})}),d.push(c)}),b.vm.ingredients=d,b.vm.loadIngredients.loaded=!0,c.resolve()}else b.vm.loadIngredients.loadingFailed=!0,c.reject()},function(a){b.vm.loadIngredients.loadingFailed=!0,c.reject()}),d["finally"](function(){b.vm.loadIngredients.loading=!1}),c.promise},b.clearIngredients=function(){b.vm.ingredients=[]},b.basketOverlayOpen=function(){if(b.vm.selectedStore.available&&b.vm.recipes.length){var a=[];angular.forEach(b.vm.recipes,function(b){b.isDeleted||a.push(b.externalId)}),a.length&&h.sendMessage({action:"cco-render-basket",url:i.opts.initSettings["a2b-url"],urlParams:{app_id:i.opts.appId,data:g.buildA2bDataString(a)},storeId:b.vm.selectedStore.id,appType:"addtobasket",canDestroy:!1,canCloseOnOuterClick:!1,behaviorDesktop:"dynamic",behaviorMobile:"mobile",width:730,mobileBreakpoint:821,styleBgColor:"#ffffff",styleBorderWidth:6})}},b.createRecipesArray=function(){if(b.vm.shoppingList.shoppableObjects){var a=[];angular.forEach(b.vm.shoppingList.shoppableObjects,function(d){if("recipe"==d.type){var e={id:parseInt(d.id,10),externalId:d.externalId,parentId:d.parentId,parentInternalId:null,name:d.title,url:d.originalUrl,thumb:d.thumbnailUrl,caption:d.parentId>0?c("filter")(b.vm.shoppingList.shoppableObjects,{id:d.parentId})[0].title:"",isDeleted:!1};if(e.parentId){var f=c("filter")(b.vm.shoppingList.shoppableObjects,{id:d.parentId})[0];e.parentInternalId=f.internalId}a.push(e)}}),a=c("orderBy")(a,"id",!0),b.vm.recipes=a,b.vm.recipeIds=[],angular.forEach(b.vm.recipes,function(a){b.vm.recipeIds.push(a.externalId)})}},b.clearShoppingList=function(){b.vm.recipes={},e.clearShoppingList(b.vm.shoppingList.id),b.vm.showClearListDialog=!1},b.init=function(){b.getShoppingList()},b.init(),b.printOverlayOpen=function(){h.sendMessage({action:"cco-render-assoc-widget",url:j.genAppUrl("printoverlay"),appType:"printoverlay",behaviorDesktop:"dynamic",behaviorMobile:"mobile",width:800,mobileBreakpoint:821})},b.toggleCarousel=function(){b.vm.showRecipes=!b.vm.showRecipes},function(){"ontouchstart"in window&&(b.vm.hoverEnabled=!1)}(),b.$watch(function(){return i.opts.lastRetailer},function(a){a&&g.isValidRetailer(a)?(b.vm.selectedStore=c("filter")(b.vm.smarkets,{id:a})[0],b.vm.selectedStore.available&&b.openA2bOnRetailerChange&&(k.track({action:"unbranded-add-to-basket",label:b.vm.selectedStore.id,value:b.vm.recipes.length}),b.basketOverlayOpen())):b.vm.selectedStore=!1,b.openA2bOnRetailerChange=!1})}]),angular.module("shoppingListAddedApp",["ui.router","constantco","gfSharedApp","templatesCache"]),angular.module("shoppingListAddedApp").config(["$stateProvider","$urlRouterProvider","$provide","$injector","$logProvider","projectConstants",function(a,b,c,d,e,f){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"shoppingListAddedMainCtrl",templateUrl:"views/shopping-list-added/main.html"}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),e.debugEnabled(f.DEBUG_LOGS_ENABLED),c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}])}]),angular.module("shoppingListAddedApp").controller("shoppingListAddedMainCtrl",["$scope","$timeout","constantcoAppConfig","constantcoFrameCommService",function(a,b,c,d){a.vm={masterType:c.opts.customData},a.close=function(){d.sendMessage({action:"cco-destroy-widget",targetWidget:"shoppinglistadded"})},b(a.close,3e3)}]),angular.module("shoppingListAlreadyAddedApp",["ui.router","constantco","gfSharedApp","templatesCache"]),angular.module("shoppingListAlreadyAddedApp").config(["$stateProvider","$urlRouterProvider","$provide","$injector","$logProvider","projectConstants",function(a,b,c,d,e,f){a.state("root",{url:"",template:"<div ui-view></div>"}).state("root.main",{url:"",controller:"shoppingListAlreadyAddedMainCtrl",templateUrl:"views/shopping-list-already-added/main.html"}),b.otherwise(function(a){var b=a.get("$state");b.go("root.main")}),e.debugEnabled(f.DEBUG_LOGS_ENABLED),c.decorator("$sniffer",["$delegate",function(a){return a.history=!1,a}])}]),angular.module("shoppingListAlreadyAddedApp").controller("shoppingListAlreadyAddedMainCtrl",["$scope","$timeout","constantcoAppConfig","constantcoFrameCommService",function(a,b,c,d){a.vm={masterType:c.opts.customData},a.close=function(a){d.sendMessage({action:"cco-destroy-widget",targetWidget:"shoppinglistalreadyadded",customData:a})}}]);